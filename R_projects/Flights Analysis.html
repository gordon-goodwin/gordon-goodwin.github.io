<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Gordon Goodwin">
<title>Flights Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="Flights Analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="Flights Analysis_files/libs/quarto-html/quarto.js"></script>
<script src="Flights Analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="Flights Analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Flights Analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="Flights Analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Flights Analysis_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Flights Analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Flights Analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Flights Analysis_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li>
<a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a>
  <ul>
<li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#profitability-objective-function" id="toc-profitability-objective-function" class="nav-link" data-scroll-target="#profitability-objective-function">Profitability Objective Function</a></li>
  </ul>
</li>
  <li>
<a href="#data-prep-exploration" id="toc-data-prep-exploration" class="nav-link" data-scroll-target="#data-prep-exploration">Data Prep &amp; Exploration</a>
  <ul>
<li><a href="#flights" id="toc-flights" class="nav-link" data-scroll-target="#flights">Flights</a></li>
  <li>
<a href="#airports" id="toc-airports" class="nav-link" data-scroll-target="#airports">Airports</a>
  <ul class="collapse">
<li><a href="#airport-data-clean-up" id="toc-airport-data-clean-up" class="nav-link" data-scroll-target="#airport-data-clean-up">Airport Data Clean-Up</a></li>
  <li><a href="#airports-data-self-join" id="toc-airports-data-self-join" class="nav-link" data-scroll-target="#airports-data-self-join">Airports Data Self-Join</a></li>
  </ul>
</li>
  <li><a href="#merge-flights-airports-data" id="toc-merge-flights-airports-data" class="nav-link" data-scroll-target="#merge-flights-airports-data">Merge Flights &amp; Airports Data</a></li>
  <li><a href="#round-trip-routes" id="toc-round-trip-routes" class="nav-link" data-scroll-target="#round-trip-routes">Round-Trip Routes</a></li>
  <li>
<a href="#tickets" id="toc-tickets" class="nav-link" data-scroll-target="#tickets">Tickets</a>
  <ul class="collapse">
<li><a href="#tickets-data-clean-up" id="toc-tickets-data-clean-up" class="nav-link" data-scroll-target="#tickets-data-clean-up">Tickets Data Clean-Up</a></li>
  <li><a href="#aggregate-tickets-data" id="toc-aggregate-tickets-data" class="nav-link" data-scroll-target="#aggregate-tickets-data">Aggregate Tickets Data</a></li>
  </ul>
</li>
  <li><a href="#merge-tickets-to-flightsairports" id="toc-merge-tickets-to-flightsairports" class="nav-link" data-scroll-target="#merge-tickets-to-flightsairports">Merge Tickets to Flights/Airports</a></li>
  </ul>
</li>
  <li>
<a href="#profitability-calculations" id="toc-profitability-calculations" class="nav-link" data-scroll-target="#profitability-calculations">Profitability Calculations</a>
  <ul>
<li><a href="#revenue" id="toc-revenue" class="nav-link" data-scroll-target="#revenue">Revenue</a></li>
  <li><a href="#costs" id="toc-costs" class="nav-link" data-scroll-target="#costs">Costs</a></li>
  <li><a href="#profit" id="toc-profit" class="nav-link" data-scroll-target="#profit">Profit</a></li>
  </ul>
</li>
  <li>
<a href="#findings" id="toc-findings" class="nav-link" data-scroll-target="#findings">Findings</a>
  <ul>
<li><a href="#top-10-busiest-routes" id="toc-top-10-busiest-routes" class="nav-link" data-scroll-target="#top-10-busiest-routes">Top 10 Busiest Routes</a></li>
  <li>
<a href="#top-10-profitable-routes" id="toc-top-10-profitable-routes" class="nav-link" data-scroll-target="#top-10-profitable-routes">Top 10 Profitable Routes</a>
  <ul class="collapse">
<li>
<a href="#routes" id="toc-routes" class="nav-link" data-scroll-target="#routes">Routes</a>
  <ul class="collapse">
<li><a href="#vail-co---new-york" id="toc-vail-co---new-york" class="nav-link" data-scroll-target="#vail-co---new-york">Vail, CO - New York</a></li>
  <li><a href="#carrier-variability" id="toc-carrier-variability" class="nav-link" data-scroll-target="#carrier-variability">Carrier Variability</a></li>
  </ul>
</li>
  <li>
<a href="#routes-carriers" id="toc-routes-carriers" class="nav-link" data-scroll-target="#routes-carriers">Routes &amp; Carriers</a>
  <ul class="collapse">
<li><a href="#charlotte-raleigh" id="toc-charlotte-raleigh" class="nav-link" data-scroll-target="#charlotte-raleigh">Charlotte-Raleigh</a></li>
  <li><a href="#profit-revenue-cost-interaction" id="toc-profit-revenue-cost-interaction" class="nav-link" data-scroll-target="#profit-revenue-cost-interaction">Profit, Revenue, Cost Interaction</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#drivers-kpis" id="toc-drivers-kpis" class="nav-link" data-scroll-target="#drivers-kpis">Drivers &amp; KPIs</a>
  <ul class="collapse">
<li><a href="#profitability-heatmap" id="toc-profitability-heatmap" class="nav-link" data-scroll-target="#profitability-heatmap">Profitability Heatmap</a></li>
  <li><a href="#driver-takeaways" id="toc-driver-takeaways" class="nav-link" data-scroll-target="#driver-takeaways">Driver Takeaways</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#final-recommendation" id="toc-final-recommendation" class="nav-link" data-scroll-target="#final-recommendation">Final Recommendation</a>
  <ul>
<li><a href="#top-5-recommended-routes" id="toc-top-5-recommended-routes" class="nav-link" data-scroll-target="#top-5-recommended-routes">Top 5 Recommended Routes</a></li>
  <li><a href="#roi-to-break-even" id="toc-roi-to-break-even" class="nav-link" data-scroll-target="#roi-to-break-even">ROI to Break Even</a></li>
  <li>
<a href="#kpi-monitoring" id="toc-kpi-monitoring" class="nav-link" data-scroll-target="#kpi-monitoring">KPI Monitoring</a>
  <ul class="collapse">
<li><a href="#additional-considerations-limitations" id="toc-additional-considerations-limitations" class="nav-link" data-scroll-target="#additional-considerations-limitations">Additional Considerations &amp; Limitations</a></li>
  </ul>
</li>
  </ul>
</li>
  <li>
<a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a>
  <ul>
<li>
<a href="#cost-revenue-assumptions" id="toc-cost-revenue-assumptions" class="nav-link" data-scroll-target="#cost-revenue-assumptions">Cost &amp; Revenue Assumptions</a>
  <ul class="collapse">
<li><a href="#costs-1" id="toc-costs-1" class="nav-link" data-scroll-target="#costs-1">Costs</a></li>
  <li><a href="#revenue-1" id="toc-revenue-1" class="nav-link" data-scroll-target="#revenue-1">Revenue</a></li>
  </ul>
</li>
  </ul>
</li>
  </ul></nav>
</div>
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">Flights Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gordon Goodwin </p>
          </div>
  </div>
    
  
    
  </div>
  

</header><hr>
<section id="introduction" class="level1"><h1>Introduction</h1>
<p>GG Airlines (GGA) is attempting to enter the U.S. domestic air market with an initial 5-plane investment. This analysis seeks to support the GGA expansion by using 1Q2019 U.S. aviation data to recommend 5 potential round-trip routes based on volume, profitability, and any other relevant KPIs.</p>
<section id="background" class="level2"><h2 class="anchored" data-anchor-id="background">Background</h2>
<ul>
<li>
<p>Only direct dual-leg round-trip routes between medium or large U.S. airports were considered</p>
<ul>
<li>Origin of Leg 1 = Destination of Leg 2 (<code>CLT</code> - <code>RDU</code> - <code>CLT</code>)</li>
</ul>
</li>
<li><p>Each of the 5 planes will be dedicated to a single route (5 planes, 5 routes)</p></li>
<li><p>Punctuality is a core component of the GGA brand</p></li>
</ul></section><section id="profitability-objective-function" class="level2"><h2 class="anchored" data-anchor-id="profitability-objective-function">Profitability Objective Function</h2>
<p>Profitability was first calculated at the individual flight level and then aggregated across routes and carriers (discussed further later). At a high level, profitability can be broken down into:</p>
<p><span class="math display">\[
Profit = [(Baggage + Fare)*Passengers]-[(OpCosts*Distance) + Delays + AirportCost]
\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Further detail regarding calculations and relevant assumptions can be found in the Appendix
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section></section><section id="data-prep-exploration" class="level1"><h1>Data Prep &amp; Exploration</h1>
<p>This project uses aviation data from the first quarter of 2019, combining information from three datasets on <code>flights</code>, <code>tickets</code>, and <code>airports</code>. The preliminary datasets were explored, transformed, and merged to create a final dataset organized with <strong>one row per round-trip flight</strong>. Each round-trip flight is uniquely identified by a combination of: <code>carrier_code</code>, <code>plane_tail_number</code>, <code>carrier_flight_number</code>, and <code>flight_date</code>.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># No Scientific Mode for numeric vars</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Source Fns</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">source</span>(<span class="st">"Airline Functions.R"</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co"># List Data CSV Files in working directory</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">list.files</span>(<span class="at">pattern =</span> <span class="st">".csv"</span>) <span class="ot">-&gt;</span> files2load</span>
<span id="cb1-9"><a href="#cb1-9"></a></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co"># Iteratively load filelist and clean names while loading</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="fu">map</span>(files2load, cleanreader) <span class="ot">-&gt;</span> filelist</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co"># name dataframes to match corresponding filepath name</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="fu">names</span>(filelist) <span class="ot">&lt;-</span> <span class="fu">str_to_lower</span>(<span class="fu">str_remove_all</span>(files2load, <span class="st">".csv"</span>))</span>
<span id="cb1-15"><a href="#cb1-15"></a></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="do">## Assign objects</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="fu">list2env</span>(filelist, .GlobalEnv)</span>
<span id="cb1-18"><a href="#cb1-18"></a></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co"># Remove list to clear memory</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="fu">rm</span>(filelist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The above code will import all CSV files currently residing in your working directory simultaneously.
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<section id="flights" class="level2"><h2 class="anchored" data-anchor-id="flights">Flights</h2>
<p>After loading our <code>flights</code> dataset, we perform some basic clean-up steps by parsing the <code>distance</code> and <code>flight_date</code> fields, removing duplicate records, and filtering out flights that are cancelled or whose origin and destination IATA codes are the same.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Replace fl_date, clean/parse distance from character to numeric variable</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="at">fl_date =</span> <span class="fu">datefixer</span>(fl_date),</span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="at">distance =</span> <span class="fu">str_replace_all</span>(<span class="fu">str_remove_all</span>(distance, <span class="st">"</span><span class="sc">\\</span><span class="st">.0"</span>), <span class="st">"^-?0+"</span>, <span class="st">""</span>),</span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="at">distance =</span> <span class="fu">abs</span>(<span class="fu">parse_number</span>(distance))</span>
<span id="cb2-7"><a href="#cb2-7"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb2-8"><a href="#cb2-8"></a>  <span class="co"># De-Dupe</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span> </span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="co"># Format names for later join and clarity</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="fu">rename</span>(<span class="at">origin_iata =</span> origin,</span>
<span id="cb2-12"><a href="#cb2-12"></a>         <span class="at">destin_iata =</span> destination) <span class="sc">|&gt;</span> </span>
<span id="cb2-13"><a href="#cb2-13"></a>  <span class="co"># Remove flights where origin = destination, flight is cancelled, or distance invalid</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>  <span class="fu">filter</span>(origin_iata <span class="sc">!=</span> destin_iata,</span>
<span id="cb2-15"><a href="#cb2-15"></a>         cancelled <span class="sc">==</span> <span class="dv">0</span>) <span class="ot">-&gt;</span> flights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As <a href="#fig-flights-missingness">Figure&nbsp;1</a> shows below, while 5 variables in the <code>flights</code> dataset are missing values, only <code>air-time</code> and <code>arrival_delays</code> register more than 0.01% missingness. On the whole, none of the <code>flights</code> variables initially appear to be missing an impactful number of data points</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">missingval_viz</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-flights-missingness" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Flights-Analysis_files/figure-html/fig-flights-missingness-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Missingness patterns for variables missing values</figcaption></figure>
</div>
</div>
</div>
<p>Lastly, records for flights missing values on any of the <code>arrival_delay</code>, <code>occupancy_rate</code>, <code>distance</code>, or <code>flight_number</code> variables are removed, as those fields are all necessary for profitability calculations.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Filter out flights missing vars needed for profit aside from distance</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(op_carrier_fl_num),</span>
<span id="cb4-4"><a href="#cb4-4"></a>         <span class="sc">!</span><span class="fu">is.na</span>(arr_delay),</span>
<span id="cb4-5"><a href="#cb4-5"></a>         <span class="sc">!</span><span class="fu">is.na</span>(occupancy_rate),</span>
<span id="cb4-6"><a href="#cb4-6"></a>         <span class="sc">!</span><span class="fu">is.na</span>(distance)) <span class="ot">-&gt;</span> flights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="airports" class="level2"><h2 class="anchored" data-anchor-id="airports">Airports</h2>
<p>In order to facilitate joining the <code>airport</code> data to the <code>flights</code> data, the <code>airports</code> dataset needs to be cleaned and structured in a format with 1 row for each possible combination of origin and destination airports.</p>
<section id="airport-data-clean-up" class="level3"><h3 class="anchored" data-anchor-id="airport-data-clean-up">Airport Data Clean-Up</h3>
<p>We begin by parsing <code>latitude</code> and <code>longitude</code> from the <code>coordinates</code> field, removing duplicates, and establishing origin and destination fields.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>airport_codes <span class="sc">|&gt;</span> </span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="co"># De-dupe</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="co"># Separate Lat/Longitude and convert to Numeric form</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="fu">separate_wider_delim</span>(<span class="at">cols =</span> coordinates,</span>
<span id="cb5-6"><a href="#cb5-6"></a>                       <span class="at">delim =</span> <span class="st">", "</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>                       <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"latitude"</span>,<span class="st">"longitude"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(<span class="st">"latitude"</span>, <span class="st">"longitude"</span>),</span>
<span id="cb5-9"><a href="#cb5-9"></a>                <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">as.numeric</span>(.x))) <span class="sc">|&gt;</span> </span>
<span id="cb5-10"><a href="#cb5-10"></a>  <span class="co"># Create origin and destin cols necessary for join with flights data</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>  <span class="fu">mutate</span>(<span class="at">origin_iata =</span> iata_code,</span>
<span id="cb5-12"><a href="#cb5-12"></a>         <span class="at">origin_type =</span> type,</span>
<span id="cb5-13"><a href="#cb5-13"></a>         <span class="at">destin_iata =</span> iata_code,</span>
<span id="cb5-14"><a href="#cb5-14"></a>         <span class="at">destin_type =</span> type,</span>
<span id="cb5-15"><a href="#cb5-15"></a>         <span class="at">origin_latitude =</span> latitude,</span>
<span id="cb5-16"><a href="#cb5-16"></a>         <span class="at">origin_longitude =</span> longitude,</span>
<span id="cb5-17"><a href="#cb5-17"></a>         <span class="at">destin_latitude =</span> latitude,</span>
<span id="cb5-18"><a href="#cb5-18"></a>         <span class="at">destin_longitude =</span> longitude) <span class="ot">-&gt;</span> airport_codes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As <a href="#fig-flights-missingness">Figure&nbsp;1</a> shows, it initially appears that almost 85% of our <code>airport</code> data records are missing the <code>iata_code</code> values needed to join to our <code>flights</code> data. We are also missing some <code>iso_country</code> values, but those records are all associated with airports on the African continent.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>airport_codes <span class="sc">|&gt;</span> <span class="fu">missingval_viz</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-missingness_airportcodes" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Flights-Analysis_files/figure-html/fig-missingness_airportcodes-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Initial missingness for airport_codes data</figcaption></figure>
</div>
</div>
</div>
<p>Lastly, after filtering for just U.S. med/large airports, <a href="#fig-missingness_airportcodes_USmedlarge">Figure&nbsp;3</a> shows that 96% of the <code>iata_code</code> records are now valid.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Filter for just US medium/large airports  </span></span>
<span id="cb7-2"><a href="#cb7-2"></a>airport_codes <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">filter</span>(iso_country <span class="sc">==</span> <span class="st">"US"</span>,</span>
<span id="cb7-4"><a href="#cb7-4"></a>         type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'medium_airport'</span>,<span class="st">"large_airport"</span>)) <span class="ot">-&gt;</span> airport_codes_medlarge</span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a>airport_codes_medlarge <span class="sc">|&gt;</span> <span class="fu">missingval_viz</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-missingness_airportcodes_USmedlarge" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Flights-Analysis_files/figure-html/fig-missingness_airportcodes_USmedlarge-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;3: revised missingness for airport_codes data</figcaption></figure>
</div>
</div>
</div>
<p>As <code>iata_code</code> is required to join to our <code>flights</code> data, we remove any remaining NA records.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># Remove missing iata code</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>airport_codes_medlarge <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(iata_code)) <span class="ot">-&gt;</span> airport_codes_medlarge</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Several IATA codes were shared by an open and a closed airport, but only one (Austin) was a med/large U.S. airport
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section><section id="airports-data-self-join" class="level3"><h3 class="anchored" data-anchor-id="airports-data-self-join">Airports Data Self-Join</h3>
<p>For the final formatting step, the <code>airports</code> data is self-joined to create a full cross-product grid of all possible origin and destination pairs of medium/large U.S. airports.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Create grid of crossprods of origin and destination for flights data join</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>airport_codes_medlarge <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="co"># Cross Product Grid</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>  <span class="fu">crossprodder</span>(<span class="at">complete =</span> F,</span>
<span id="cb9-5"><a href="#cb9-5"></a>               origin_iata, destin_iata) <span class="sc">|&gt;</span> </span>
<span id="cb9-6"><a href="#cb9-6"></a>  <span class="co"># Inner Join back to self to pull in origin section metadata</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="fu">inner_join</span>(airport_codes_medlarge <span class="sc">|&gt;</span> </span>
<span id="cb9-8"><a href="#cb9-8"></a>               <span class="fu">select</span>(origin_iata, origin_type,</span>
<span id="cb9-9"><a href="#cb9-9"></a>                      origin_latitude, origin_longitude),</span>
<span id="cb9-10"><a href="#cb9-10"></a>             <span class="at">by =</span> <span class="st">"origin_iata"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-11"><a href="#cb9-11"></a>  <span class="co"># Inner Join back to self to pull in destination section metadata</span></span>
<span id="cb9-12"><a href="#cb9-12"></a>  <span class="fu">inner_join</span>(airport_codes_medlarge <span class="sc">|&gt;</span> </span>
<span id="cb9-13"><a href="#cb9-13"></a>               <span class="fu">select</span>(destin_iata, destin_type,</span>
<span id="cb9-14"><a href="#cb9-14"></a>                      destin_latitude, destin_longitude),</span>
<span id="cb9-15"><a href="#cb9-15"></a>             <span class="at">by =</span> <span class="st">"destin_iata"</span>) <span class="ot">-&gt;</span> airport_codes_medlarge</span>
<span id="cb9-16"><a href="#cb9-16"></a></span>
<span id="cb9-17"><a href="#cb9-17"></a><span class="co"># Glimpse</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>airport_codes_medlarge <span class="sc">|&gt;</span> </span>
<span id="cb9-19"><a href="#cb9-19"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-20"><a href="#cb9-20"></a>  <span class="fu">select</span>(origin_iata, origin_type, destin_iata, destin_type) <span class="sc">|&gt;</span> </span>
<span id="cb9-21"><a href="#cb9-21"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb9-22"><a href="#cb9-22"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Random Sample of Airport Grid for Validation**"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="efctrhahnk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#efctrhahnk table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#efctrhahnk thead, #efctrhahnk tbody, #efctrhahnk tfoot, #efctrhahnk tr, #efctrhahnk td, #efctrhahnk th {
  border-style: none;
}

#efctrhahnk p {
  margin: 0;
  padding: 0;
}

#efctrhahnk .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#efctrhahnk .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#efctrhahnk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#efctrhahnk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#efctrhahnk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#efctrhahnk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#efctrhahnk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#efctrhahnk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#efctrhahnk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#efctrhahnk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#efctrhahnk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#efctrhahnk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#efctrhahnk .gt_spanner_row {
  border-bottom-style: hidden;
}

#efctrhahnk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#efctrhahnk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#efctrhahnk .gt_from_md > :first-child {
  margin-top: 0;
}

#efctrhahnk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#efctrhahnk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#efctrhahnk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#efctrhahnk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#efctrhahnk .gt_row_group_first td {
  border-top-width: 2px;
}

#efctrhahnk .gt_row_group_first th {
  border-top-width: 2px;
}

#efctrhahnk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#efctrhahnk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#efctrhahnk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#efctrhahnk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#efctrhahnk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#efctrhahnk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#efctrhahnk .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#efctrhahnk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#efctrhahnk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#efctrhahnk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#efctrhahnk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#efctrhahnk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#efctrhahnk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#efctrhahnk .gt_left {
  text-align: left;
}

#efctrhahnk .gt_center {
  text-align: center;
}

#efctrhahnk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#efctrhahnk .gt_font_normal {
  font-weight: normal;
}

#efctrhahnk .gt_font_bold {
  font-weight: bold;
}

#efctrhahnk .gt_font_italic {
  font-style: italic;
}

#efctrhahnk .gt_super {
  font-size: 65%;
}

#efctrhahnk .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#efctrhahnk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#efctrhahnk .gt_indent_1 {
  text-indent: 5px;
}

#efctrhahnk .gt_indent_2 {
  text-indent: 10px;
}

#efctrhahnk .gt_indent_3 {
  text-indent: 15px;
}

#efctrhahnk .gt_indent_4 {
  text-indent: 20px;
}

#efctrhahnk .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="4" class="gt_heading gt_title gt_font_normal gt_bottom_border" style=""><strong>Random Sample of Airport Grid for Validation</strong></td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="origin_iata">origin_iata</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="origin_type">origin_type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="destin_iata">destin_iata</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="destin_type">destin_type</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr>
<td headers="origin_iata" class="gt_row gt_left">LSV</td>
<td headers="origin_type" class="gt_row gt_left">medium_airport</td>
<td headers="destin_iata" class="gt_row gt_left">ORH</td>
<td headers="destin_type" class="gt_row gt_left">medium_airport</td>
</tr>
<tr>
<td headers="origin_iata" class="gt_row gt_left">YNG</td>
<td headers="origin_type" class="gt_row gt_left">medium_airport</td>
<td headers="destin_iata" class="gt_row gt_left">PDK</td>
<td headers="destin_type" class="gt_row gt_left">medium_airport</td>
</tr>
<tr>
<td headers="origin_iata" class="gt_row gt_left">PTK</td>
<td headers="origin_type" class="gt_row gt_left">medium_airport</td>
<td headers="destin_iata" class="gt_row gt_left">NHZ</td>
<td headers="destin_type" class="gt_row gt_left">medium_airport</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section></section><section id="merge-flights-airports-data" class="level2"><h2 class="anchored" data-anchor-id="merge-flights-airports-data">Merge Flights &amp; Airports Data</h2>
<p>The cross-product grid of origin/destination <code>airport</code> pairs is then joined to the <code>flights</code> data to create an intermediate dataset containing both origin and destination medium/large <code>flights</code> and <code>airports</code> data. First, the fields in both datasets are compared to derive the primary keys (<code>origin_iata</code>, <code>destin_iata</code>)</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Cross-check common and unique columns before join</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="fu">compare_df_cols</span>(airport_codes,</span>
<span id="cb10-3"><a href="#cb10-3"></a>                flights)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>$common_cols
[1] "origin_iata" "destin_iata"

$unique_cols
$unique_cols[[1]]
 [1] "type"             "name"             "elevation_ft"     "continent"       
 [5] "iso_country"      "municipality"     "iata_code"        "latitude"        
 [9] "longitude"        "origin_type"      "destin_type"      "origin_latitude" 
[13] "origin_longitude" "destin_latitude"  "destin_longitude"

$unique_cols[[2]]
 [1] "fl_date"           "op_carrier"        "tail_num"         
 [4] "op_carrier_fl_num" "origin_airport_id" "origin_city_name" 
 [7] "dest_airport_id"   "dest_city_name"    "dep_delay"        
[10] "arr_delay"         "cancelled"         "air_time"         
[13] "distance"          "occupancy_rate"   </code></pre>
</div>
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Store common cols as primary keys</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">compare_df_cols</span>(airport_codes,</span>
<span id="cb12-3"><a href="#cb12-3"></a>                flights)<span class="sc">$</span>common_cols <span class="ot">-&gt;</span> primarykeys_airports_flights</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, the join is performed and the output validated:</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># inner join flights to med/large US airport origin/destination pairs</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>flights <span class="sc">|&gt;</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">inner_join</span>(airport_codes_medlarge,</span>
<span id="cb13-4"><a href="#cb13-4"></a>             <span class="at">by =</span> primarykeys_airports_flights) <span class="ot">-&gt;</span> flights_medlarge</span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="co"># Check</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>flights_medlarge <span class="sc">|&gt;</span> </span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="fu">select</span>(op_carrier, tail_num, origin_iata, origin_city_name,origin_type,</span>
<span id="cb13-9"><a href="#cb13-9"></a>         destin_iata, dest_city_name,destin_type) <span class="sc">|&gt;</span> </span>
<span id="cb13-10"><a href="#cb13-10"></a>  <span class="fu">head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb13-12"><a href="#cb13-12"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Validation Sample Showing Airport Info Pulled In**"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="cdpwvybykh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#cdpwvybykh table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#cdpwvybykh thead, #cdpwvybykh tbody, #cdpwvybykh tfoot, #cdpwvybykh tr, #cdpwvybykh td, #cdpwvybykh th {
  border-style: none;
}

#cdpwvybykh p {
  margin: 0;
  padding: 0;
}

#cdpwvybykh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cdpwvybykh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#cdpwvybykh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cdpwvybykh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cdpwvybykh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cdpwvybykh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cdpwvybykh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cdpwvybykh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cdpwvybykh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cdpwvybykh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cdpwvybykh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cdpwvybykh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cdpwvybykh .gt_spanner_row {
  border-bottom-style: hidden;
}

#cdpwvybykh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#cdpwvybykh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cdpwvybykh .gt_from_md > :first-child {
  margin-top: 0;
}

#cdpwvybykh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cdpwvybykh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cdpwvybykh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cdpwvybykh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cdpwvybykh .gt_row_group_first td {
  border-top-width: 2px;
}

#cdpwvybykh .gt_row_group_first th {
  border-top-width: 2px;
}

#cdpwvybykh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cdpwvybykh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cdpwvybykh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cdpwvybykh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cdpwvybykh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cdpwvybykh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cdpwvybykh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#cdpwvybykh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cdpwvybykh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cdpwvybykh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cdpwvybykh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cdpwvybykh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cdpwvybykh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cdpwvybykh .gt_left {
  text-align: left;
}

#cdpwvybykh .gt_center {
  text-align: center;
}

#cdpwvybykh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cdpwvybykh .gt_font_normal {
  font-weight: normal;
}

#cdpwvybykh .gt_font_bold {
  font-weight: bold;
}

#cdpwvybykh .gt_font_italic {
  font-style: italic;
}

#cdpwvybykh .gt_super {
  font-size: 65%;
}

#cdpwvybykh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#cdpwvybykh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cdpwvybykh .gt_indent_1 {
  text-indent: 5px;
}

#cdpwvybykh .gt_indent_2 {
  text-indent: 10px;
}

#cdpwvybykh .gt_indent_3 {
  text-indent: 15px;
}

#cdpwvybykh .gt_indent_4 {
  text-indent: 20px;
}

#cdpwvybykh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="8" class="gt_heading gt_title gt_font_normal gt_bottom_border" style=""><strong>Validation Sample Showing Airport Info Pulled In</strong></td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="op_carrier">op_carrier</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="tail_num">tail_num</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="origin_iata">origin_iata</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="origin_city_name">origin_city_name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="origin_type">origin_type</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="destin_iata">destin_iata</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="dest_city_name">dest_city_name</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="destin_type">destin_type</th>
    </tr>
</thead>
<tbody class="gt_table_body"><tr>
<td headers="op_carrier" class="gt_row gt_left">WN</td>
<td headers="tail_num" class="gt_row gt_left">N955WN</td>
<td headers="origin_iata" class="gt_row gt_left">RSW</td>
<td headers="origin_city_name" class="gt_row gt_left">Fort Myers, FL</td>
<td headers="origin_type" class="gt_row gt_left">large_airport</td>
<td headers="destin_iata" class="gt_row gt_left">CLE</td>
<td headers="dest_city_name" class="gt_row gt_left">Cleveland, OH</td>
<td headers="destin_type" class="gt_row gt_left">large_airport</td>
</tr></tbody>
</table>
</div>
</div>
</div>
</section><section id="round-trip-routes" class="level2"><h2 class="anchored" data-anchor-id="round-trip-routes">Round-Trip Routes</h2>
<p>A self-join is employed upon the<code>flights/airports</code> data to isolate only those routes where the destination of leg 1 is the origin of leg 2, and the destination of leg 2 is the origin of leg 1. In this join, the right side effectively serves as leg 1, the left side serves as leg 2, and each flight is uniquely identified via a combination of <code>carrier</code>, <code>carrier_flight_number</code>, <code>tail_number</code>, and <code>flight_date</code> primary key fields.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Round Trip identified by: origin 1 = dest 2, dest 2 = origin 1</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>flights_medlarge <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="co"># Self Join where "Right" side = Leg 1, "Left" side = Leg 2</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">inner_join</span>(flights_medlarge, </span>
<span id="cb14-5"><a href="#cb14-5"></a>             <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"op_carrier"</span>, </span>
<span id="cb14-6"><a href="#cb14-6"></a>                    <span class="st">"op_carrier_fl_num"</span>, </span>
<span id="cb14-7"><a href="#cb14-7"></a>                    <span class="st">"tail_num"</span>,<span class="st">"fl_date"</span>),</span>
<span id="cb14-8"><a href="#cb14-8"></a>             <span class="at">relationship =</span> <span class="st">"many-to-many"</span>,</span>
<span id="cb14-9"><a href="#cb14-9"></a>             <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_leg1"</span>,<span class="st">"_leg2"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb14-10"><a href="#cb14-10"></a>  <span class="fu">filter</span>(</span>
<span id="cb14-11"><a href="#cb14-11"></a>    <span class="co"># Filter for round trip: origin 1 = dest 2, dest 2 = origin 1</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>    origin_iata_leg1 <span class="sc">==</span> destin_iata_leg2,</span>
<span id="cb14-13"><a href="#cb14-13"></a>    destin_iata_leg1 <span class="sc">==</span> origin_iata_leg2</span>
<span id="cb14-14"><a href="#cb14-14"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb14-15"><a href="#cb14-15"></a>  <span class="fu">arrange</span>(op_carrier, fl_date, op_carrier_fl_num,fl_date) <span class="ot">-&gt;</span> flights_medlarge_roundtrip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Before checking the final results, a few final clean-up steps are taken to:</p>
<ul>
<li><p>Create a single-field round-trip route identifier (e.g.&nbsp;<code>CLT-RDU</code>)</p></li>
<li>
<p>Filter out the now-redundant secondary rows for each round-trip flight</p>
<ul>
<li>(all necessary info for both legs is now in a single row).</li>
</ul>
</li>
<li><p>Create custom <code>distance_crowfly</code> fields using point-to-point calculations from the <code>latitude</code> and <code>longitude</code> fields to validate the original <code>distance</code> values.</p></li>
</ul>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="co"># round all numeric cols to 2 digits for clarity</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb15-4"><a href="#cb15-4"></a>                <span class="sc">~</span><span class="fu">round</span>(.x, <span class="dv">2</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="co"># Create single field identifying the route and calculate crow-fly distance</span></span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="fu">mutate</span>(<span class="at">route_iata =</span> <span class="fu">paste</span>(origin_iata_leg1, destin_iata_leg1, <span class="at">sep =</span> <span class="st">"-"</span>),</span>
<span id="cb15-7"><a href="#cb15-7"></a>         <span class="at">route_city_name =</span> <span class="fu">paste</span>(origin_city_name_leg1, </span>
<span id="cb15-8"><a href="#cb15-8"></a>                                 dest_city_name_leg1, <span class="at">sep =</span> <span class="st">"-"</span>),</span>
<span id="cb15-9"><a href="#cb15-9"></a>         <span class="co"># Crow-Fly distance for each leg and then total crow fly</span></span>
<span id="cb15-10"><a href="#cb15-10"></a>         <span class="at">distance_crowfly_leg1 =</span> <span class="fu">crowfly_distance_miles</span>(<span class="at">lat1 =</span> origin_latitude_leg1,</span>
<span id="cb15-11"><a href="#cb15-11"></a>                                                        <span class="at">lon1 =</span> origin_longitude_leg1,</span>
<span id="cb15-12"><a href="#cb15-12"></a>                                                        <span class="at">lat2 =</span> destin_latitude_leg1,</span>
<span id="cb15-13"><a href="#cb15-13"></a>                                                        <span class="at">lon2 =</span> destin_longitude_leg1),</span>
<span id="cb15-14"><a href="#cb15-14"></a>         <span class="at">distance_crowfly_leg2 =</span> <span class="fu">crowfly_distance_miles</span>(<span class="at">lat1 =</span> origin_latitude_leg2,</span>
<span id="cb15-15"><a href="#cb15-15"></a>                                                        <span class="at">lon1 =</span> origin_longitude_leg2,</span>
<span id="cb15-16"><a href="#cb15-16"></a>                                                        <span class="at">lat2 =</span> destin_latitude_leg2,</span>
<span id="cb15-17"><a href="#cb15-17"></a>                                                        <span class="at">lon2 =</span> destin_longitude_leg2),</span>
<span id="cb15-18"><a href="#cb15-18"></a>         <span class="at">distance_crowfly_total =</span> distance_crowfly_leg1 <span class="sc">+</span> distance_crowfly_leg2) <span class="sc">|&gt;</span> </span>
<span id="cb15-19"><a href="#cb15-19"></a>  <span class="co"># Round to 2 digits for numeric cols</span></span>
<span id="cb15-20"><a href="#cb15-20"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb15-21"><a href="#cb15-21"></a>                <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">round</span>(.x, <span class="dv">2</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb15-22"><a href="#cb15-22"></a>  <span class="co"># De-Dupe</span></span>
<span id="cb15-23"><a href="#cb15-23"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-24"><a href="#cb15-24"></a>  <span class="co"># Filter out redundant secondary rows for each flight</span></span>
<span id="cb15-25"><a href="#cb15-25"></a>  <span class="co"># we have 1 row per round-trip flight with all info for both legs on 1 row</span></span>
<span id="cb15-26"><a href="#cb15-26"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb15-27"><a href="#cb15-27"></a>         <span class="at">.by =</span> <span class="fu">c</span>(fl_date, op_carrier, </span>
<span id="cb15-28"><a href="#cb15-28"></a>                 tail_num, op_carrier_fl_num)) <span class="ot">-&gt;</span> flights_medlarge_roundtrip </span>
<span id="cb15-29"><a href="#cb15-29"></a></span>
<span id="cb15-30"><a href="#cb15-30"></a><span class="co"># Random sample a few rows to validate process</span></span>
<span id="cb15-31"><a href="#cb15-31"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb15-32"><a href="#cb15-32"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-33"><a href="#cb15-33"></a>  <span class="fu">select</span>(origin_iata_leg1, destin_iata_leg1, distance_leg1,</span>
<span id="cb15-34"><a href="#cb15-34"></a>         origin_iata_leg2, destin_iata_leg2, distance_leg2) <span class="sc">|&gt;</span> </span>
<span id="cb15-35"><a href="#cb15-35"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb15-36"><a href="#cb15-36"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Random Sample of Round-Trips to Validate**"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="xwyybpkstq" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#xwyybpkstq table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#xwyybpkstq thead, #xwyybpkstq tbody, #xwyybpkstq tfoot, #xwyybpkstq tr, #xwyybpkstq td, #xwyybpkstq th {
  border-style: none;
}

#xwyybpkstq p {
  margin: 0;
  padding: 0;
}

#xwyybpkstq .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xwyybpkstq .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#xwyybpkstq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xwyybpkstq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xwyybpkstq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xwyybpkstq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xwyybpkstq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xwyybpkstq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xwyybpkstq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xwyybpkstq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xwyybpkstq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xwyybpkstq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xwyybpkstq .gt_spanner_row {
  border-bottom-style: hidden;
}

#xwyybpkstq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#xwyybpkstq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xwyybpkstq .gt_from_md > :first-child {
  margin-top: 0;
}

#xwyybpkstq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xwyybpkstq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xwyybpkstq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xwyybpkstq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xwyybpkstq .gt_row_group_first td {
  border-top-width: 2px;
}

#xwyybpkstq .gt_row_group_first th {
  border-top-width: 2px;
}

#xwyybpkstq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xwyybpkstq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xwyybpkstq .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xwyybpkstq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xwyybpkstq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xwyybpkstq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xwyybpkstq .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#xwyybpkstq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xwyybpkstq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xwyybpkstq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xwyybpkstq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xwyybpkstq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xwyybpkstq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xwyybpkstq .gt_left {
  text-align: left;
}

#xwyybpkstq .gt_center {
  text-align: center;
}

#xwyybpkstq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xwyybpkstq .gt_font_normal {
  font-weight: normal;
}

#xwyybpkstq .gt_font_bold {
  font-weight: bold;
}

#xwyybpkstq .gt_font_italic {
  font-style: italic;
}

#xwyybpkstq .gt_super {
  font-size: 65%;
}

#xwyybpkstq .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#xwyybpkstq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xwyybpkstq .gt_indent_1 {
  text-indent: 5px;
}

#xwyybpkstq .gt_indent_2 {
  text-indent: 10px;
}

#xwyybpkstq .gt_indent_3 {
  text-indent: 15px;
}

#xwyybpkstq .gt_indent_4 {
  text-indent: 20px;
}

#xwyybpkstq .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="6" class="gt_heading gt_title gt_font_normal gt_bottom_border" style=""><strong>Random Sample of Round-Trips to Validate</strong></td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="origin_iata_leg1">origin_iata_leg1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="destin_iata_leg1">destin_iata_leg1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="distance_leg1">distance_leg1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="origin_iata_leg2">origin_iata_leg2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="destin_iata_leg2">destin_iata_leg2</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="distance_leg2">distance_leg2</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr>
<td headers="origin_iata_leg1" class="gt_row gt_left">SGU</td>
<td headers="destin_iata_leg1" class="gt_row gt_left">SLC</td>
<td headers="distance_leg1" class="gt_row gt_right">272</td>
<td headers="origin_iata_leg2" class="gt_row gt_left">SLC</td>
<td headers="destin_iata_leg2" class="gt_row gt_left">SGU</td>
<td headers="distance_leg2" class="gt_row gt_right">272</td>
</tr>
<tr>
<td headers="origin_iata_leg1" class="gt_row gt_left">BHM</td>
<td headers="destin_iata_leg1" class="gt_row gt_left">CLT</td>
<td headers="distance_leg1" class="gt_row gt_right">350</td>
<td headers="origin_iata_leg2" class="gt_row gt_left">CLT</td>
<td headers="destin_iata_leg2" class="gt_row gt_left">BHM</td>
<td headers="distance_leg2" class="gt_row gt_right">350</td>
</tr>
<tr>
<td headers="origin_iata_leg1" class="gt_row gt_left">LAX</td>
<td headers="destin_iata_leg1" class="gt_row gt_left">SAN</td>
<td headers="distance_leg1" class="gt_row gt_right">109</td>
<td headers="origin_iata_leg2" class="gt_row gt_left">SAN</td>
<td headers="destin_iata_leg2" class="gt_row gt_left">LAX</td>
<td headers="distance_leg2" class="gt_row gt_right">109</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Last, the <code>distance_crowfly</code> metrics are used to quickly validate the original <code>distance</code> values. As seen below in <a href="#fig-distance_issues">Figure&nbsp;4</a> for the <code>Charlotte-Raleigh</code> route, the 2 values arent identical but are close enough to be confident in the original <code>distance</code> values.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Display improvement for Charlotte to RDU</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">filter</span>(route_iata <span class="sc">==</span> <span class="st">"CLT-RDU"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">distinct</span>(route_iata, distance_leg1, distance_crowfly_leg1) <span class="sc">|&gt;</span> </span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Original and Custom Distance Metrics**"</span>),</span>
<span id="cb16-7"><a href="#cb16-7"></a>             <span class="at">subtitle =</span> <span class="fu">md</span>(<span class="st">"*Charlotte-Raleigh route*"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div id="fig-distance_issues" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><div id="ajlthztqmh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ajlthztqmh table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ajlthztqmh thead, #ajlthztqmh tbody, #ajlthztqmh tfoot, #ajlthztqmh tr, #ajlthztqmh td, #ajlthztqmh th {
  border-style: none;
}

#ajlthztqmh p {
  margin: 0;
  padding: 0;
}

#ajlthztqmh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ajlthztqmh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ajlthztqmh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ajlthztqmh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ajlthztqmh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ajlthztqmh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ajlthztqmh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ajlthztqmh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ajlthztqmh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ajlthztqmh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ajlthztqmh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ajlthztqmh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ajlthztqmh .gt_spanner_row {
  border-bottom-style: hidden;
}

#ajlthztqmh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ajlthztqmh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ajlthztqmh .gt_from_md > :first-child {
  margin-top: 0;
}

#ajlthztqmh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ajlthztqmh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ajlthztqmh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ajlthztqmh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ajlthztqmh .gt_row_group_first td {
  border-top-width: 2px;
}

#ajlthztqmh .gt_row_group_first th {
  border-top-width: 2px;
}

#ajlthztqmh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ajlthztqmh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ajlthztqmh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ajlthztqmh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ajlthztqmh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ajlthztqmh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ajlthztqmh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ajlthztqmh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ajlthztqmh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ajlthztqmh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ajlthztqmh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ajlthztqmh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ajlthztqmh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ajlthztqmh .gt_left {
  text-align: left;
}

#ajlthztqmh .gt_center {
  text-align: center;
}

#ajlthztqmh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ajlthztqmh .gt_font_normal {
  font-weight: normal;
}

#ajlthztqmh .gt_font_bold {
  font-weight: bold;
}

#ajlthztqmh .gt_font_italic {
  font-style: italic;
}

#ajlthztqmh .gt_super {
  font-size: 65%;
}

#ajlthztqmh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ajlthztqmh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ajlthztqmh .gt_indent_1 {
  text-indent: 5px;
}

#ajlthztqmh .gt_indent_2 {
  text-indent: 10px;
}

#ajlthztqmh .gt_indent_3 {
  text-indent: 15px;
}

#ajlthztqmh .gt_indent_4 {
  text-indent: 20px;
}

#ajlthztqmh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="3" class="gt_heading gt_title gt_font_normal" style=""><strong>Original and Custom Distance Metrics</strong></td>
    </tr>
<tr class="gt_heading">
<td colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style=""><em>Charlotte-Raleigh route</em></td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="route_iata">route_iata</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="distance_leg1">distance_leg1</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="distance_crowfly_leg1">distance_crowfly_leg1</th>
    </tr>
</thead>
<tbody class="gt_table_body"><tr>
<td headers="route_iata" class="gt_row gt_left">CLT-RDU</td>
<td headers="distance_leg1" class="gt_row gt_right">130</td>
<td headers="distance_crowfly_leg1" class="gt_row gt_right">148.78</td>
</tr></tbody>
</table>
</div>
<figcaption class="figure-caption">Figure&nbsp;4: Distance Values Inaccurately Low</figcaption></figure>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
While crowfly_distance has relatively inaccurate raw values, it correctly rank orders routes by distance
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section><section id="tickets" class="level2"><h2 class="anchored" data-anchor-id="tickets">Tickets</h2>
<p>The final <code>tickets</code> data contains a sample of tickets that can be joined to our <code>flights/airports</code> data to get <code>ticket_fare</code> information for the profitability calculations.</p>
<section id="tickets-data-clean-up" class="level3"><h3 class="anchored" data-anchor-id="tickets-data-clean-up">Tickets Data Clean-Up</h3>
<p>To prepare the <code>tickets</code> data to be joined to our <code>flights/airports</code> data, initial clean-up steps are taken to remove duplicates, retain only round-trip flights, parse the ticket_fare values, and create an origin/destination structure.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># De-Dupe and filter for round trip</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>tickets <span class="sc">|&gt;</span> </span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="co"># De-Dupe</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">distinct</span>() <span class="sc">|&gt;</span> </span>
<span id="cb17-5"><a href="#cb17-5"></a>  <span class="co"># Keep only round-trip</span></span>
<span id="cb17-6"><a href="#cb17-6"></a>  <span class="fu">filter</span>(roundtrip <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb17-7"><a href="#cb17-7"></a>  <span class="co"># Parse ticket fare</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>  <span class="fu">mutate</span>(<span class="at">itin_fare =</span> <span class="fu">parse_number</span>(itin_fare)) <span class="sc">|&gt;</span> </span>
<span id="cb17-9"><a href="#cb17-9"></a>  <span class="co"># Rename fields to be consistent with flights/airports data</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>  <span class="fu">rename</span>(<span class="at">origin_iata_leg1 =</span> origin, </span>
<span id="cb17-11"><a href="#cb17-11"></a>         <span class="at">destin_iata_leg1 =</span> destination,</span>
<span id="cb17-12"><a href="#cb17-12"></a>         <span class="at">op_carrier =</span> reporting_carrier) <span class="sc">|&gt;</span> </span>
<span id="cb17-13"><a href="#cb17-13"></a>  <span class="fu">mutate</span>(<span class="at">origin_iata_leg2 =</span> destin_iata_leg1,</span>
<span id="cb17-14"><a href="#cb17-14"></a>         <span class="at">destin_iata_leg2 =</span> origin_iata_leg1,</span>
<span id="cb17-15"><a href="#cb17-15"></a>         <span class="at">route_iata =</span> <span class="fu">paste</span>(origin_iata_leg1, </span>
<span id="cb17-16"><a href="#cb17-16"></a>                            destin_iata_leg1, <span class="at">sep =</span> <span class="st">"-"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb17-17"><a href="#cb17-17"></a>  <span class="co"># Keep only necessary fields</span></span>
<span id="cb17-18"><a href="#cb17-18"></a>  <span class="fu">select</span>(itin_id, op_carrier, route_iata,origin_iata_leg1, destin_iata_leg1,</span>
<span id="cb17-19"><a href="#cb17-19"></a>         origin_iata_leg2, destin_iata_leg2, itin_fare) <span class="ot">-&gt;</span> ticketsround</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As seen below in <a href="#fig-tickets_missingness">Figure&nbsp;5</a>, a small proportion of <code>ticket_fare</code> values are missing.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Missing tickets values for round trip routes</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>ticketsround <span class="sc">|&gt;</span> <span class="fu">missingval_viz</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-tickets_missingness" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Flights-Analysis_files/figure-html/fig-tickets_missingness-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Missing data for round-trip tickets</figcaption></figure>
</div>
</div>
</div>
<p>Those records are removed, as <code>ticket_fare</code> is needed for profitability calculations.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>ticketsround <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(itin_fare)) <span class="ot">-&gt;</span> ticketsround</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="aggregate-tickets-data" class="level3"><h3 class="anchored" data-anchor-id="aggregate-tickets-data">Aggregate Tickets Data</h3>
<p>Initially the plan was to calculate an <code>average_ticket_fare</code> for each <code>route</code>, but review of the <code>ticket_fare</code> distribution in <a href="#fig-ticket_fare_outliers">Figure&nbsp;6</a> shows significant price variability amongst carriers, along with several major outliers</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Significant inter-carrier fare variability and outliers</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>ticketsround <span class="sc">|&gt;</span> </span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="fu">doublebox_viz</span>(op_carrier, itin_fare) <span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Carrier"</span>, <span class="at">y =</span> <span class="st">"Ticket Fare Distribution"</span>,</span>
<span id="cb20-5"><a href="#cb20-5"></a>       <span class="at">title =</span> <span class="st">"Significant Fare Variability Amongst Carriers"</span>,</span>
<span id="cb20-6"><a href="#cb20-6"></a>       <span class="at">subtitle =</span> <span class="st">"Highly skewed distribution with major outliers"</span>) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">40000</span>),</span>
<span id="cb20-8"><a href="#cb20-8"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">40000</span>, <span class="dv">5000</span>),</span>
<span id="cb20-9"><a href="#cb20-9"></a>                     <span class="at">labels =</span> \(x) <span class="fu">paste0</span>(<span class="st">"$"</span>,x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-ticket_fare_outliers" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Flights-Analysis_files/figure-html/fig-ticket_fare_outliers-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Boxplots of fare prices by carrier</figcaption></figure>
</div>
</div>
</div>
<p>Given the carrier variability, skewness, and outliers, a group-wise median was calculated to assign <code>median_ticket_fare</code> values to each <code>route</code> and <code>carrier</code> combination. A trimmed mean was also calculated for data exploration.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Trimmed Avg and Median fares calculated, only median will be used</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>ticketsround <span class="sc">|&gt;</span> </span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">summarize</span>(<span class="at">avg_fare =</span> <span class="fu">roundmean</span>(<span class="at">x =</span> itin_fare, <span class="at">trim =</span> <span class="fl">0.1</span>),</span>
<span id="cb21-4"><a href="#cb21-4"></a>            <span class="at">med_fare =</span> <span class="fu">median</span>(itin_fare),</span>
<span id="cb21-5"><a href="#cb21-5"></a>            <span class="at">.by =</span> <span class="fu">c</span>(route_iata,</span>
<span id="cb21-6"><a href="#cb21-6"></a>                    op_carrier)) <span class="ot">-&gt;</span> ticketsround_summary</span>
<span id="cb21-7"><a href="#cb21-7"></a></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="co"># Preview</span></span>
<span id="cb21-9"><a href="#cb21-9"></a>ticketsround_summary <span class="sc">|&gt;</span> </span>
<span id="cb21-10"><a href="#cb21-10"></a>  <span class="fu">filter</span>(route_iata<span class="sc">==</span><span class="st">"CLT-RDU"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-11"><a href="#cb21-11"></a>  <span class="fu">head</span>() <span class="sc">|&gt;</span> </span>
<span id="cb21-12"><a href="#cb21-12"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb21-13"><a href="#cb21-13"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Validation Preview of Fare Summary Metrics**"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="lyieeclwwp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lyieeclwwp table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lyieeclwwp thead, #lyieeclwwp tbody, #lyieeclwwp tfoot, #lyieeclwwp tr, #lyieeclwwp td, #lyieeclwwp th {
  border-style: none;
}

#lyieeclwwp p {
  margin: 0;
  padding: 0;
}

#lyieeclwwp .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lyieeclwwp .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lyieeclwwp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lyieeclwwp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lyieeclwwp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lyieeclwwp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lyieeclwwp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lyieeclwwp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lyieeclwwp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lyieeclwwp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lyieeclwwp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lyieeclwwp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lyieeclwwp .gt_spanner_row {
  border-bottom-style: hidden;
}

#lyieeclwwp .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lyieeclwwp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lyieeclwwp .gt_from_md > :first-child {
  margin-top: 0;
}

#lyieeclwwp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lyieeclwwp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lyieeclwwp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lyieeclwwp .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lyieeclwwp .gt_row_group_first td {
  border-top-width: 2px;
}

#lyieeclwwp .gt_row_group_first th {
  border-top-width: 2px;
}

#lyieeclwwp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lyieeclwwp .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lyieeclwwp .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lyieeclwwp .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lyieeclwwp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lyieeclwwp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lyieeclwwp .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lyieeclwwp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lyieeclwwp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lyieeclwwp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lyieeclwwp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lyieeclwwp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lyieeclwwp .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lyieeclwwp .gt_left {
  text-align: left;
}

#lyieeclwwp .gt_center {
  text-align: center;
}

#lyieeclwwp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lyieeclwwp .gt_font_normal {
  font-weight: normal;
}

#lyieeclwwp .gt_font_bold {
  font-weight: bold;
}

#lyieeclwwp .gt_font_italic {
  font-style: italic;
}

#lyieeclwwp .gt_super {
  font-size: 65%;
}

#lyieeclwwp .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lyieeclwwp .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lyieeclwwp .gt_indent_1 {
  text-indent: 5px;
}

#lyieeclwwp .gt_indent_2 {
  text-indent: 10px;
}

#lyieeclwwp .gt_indent_3 {
  text-indent: 15px;
}

#lyieeclwwp .gt_indent_4 {
  text-indent: 20px;
}

#lyieeclwwp .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="4" class="gt_heading gt_title gt_font_normal gt_bottom_border" style=""><strong>Validation Preview of Fare Summary Metrics</strong></td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="route_iata">route_iata</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="op_carrier">op_carrier</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_fare">avg_fare</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="med_fare">med_fare</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr>
<td headers="route_iata" class="gt_row gt_left">CLT-RDU</td>
<td headers="op_carrier" class="gt_row gt_left">AA</td>
<td headers="avg_fare" class="gt_row gt_right">328.6</td>
<td headers="med_fare" class="gt_row gt_right">382</td>
</tr>
<tr>
<td headers="route_iata" class="gt_row gt_left">CLT-RDU</td>
<td headers="op_carrier" class="gt_row gt_left">OH</td>
<td headers="avg_fare" class="gt_row gt_right">1159.0</td>
<td headers="med_fare" class="gt_row gt_right">1159</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section></section><section id="merge-tickets-to-flightsairports" class="level2"><h2 class="anchored" data-anchor-id="merge-tickets-to-flightsairports">Merge Tickets to Flights/Airports</h2>
<p>The final <code>flights/airports/tickets</code> dataset is created by left-joining the <code>tickets</code> <code>route</code> and <code>carrier</code>-level summary data on fare prices to the <code>flights/airports</code> data. A left-join was used in case not all <code>routes</code> and <code>carriers</code> in the flights data are present in the <code>tickets</code> data. In such cases where <code>ticket_fare</code> values were in fact missing for a specific <code>carrier</code>, the <code>route</code>-level median was imputed. If <code>route</code>-level fares were unavailable, the <code>median_imputed_fare</code> was left <code>NA</code>.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Comparison of Common Cols to be used as primary keys for join</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="fu">compare_df_cols</span>(ticketsround_summary, flights_medlarge_roundtrip)<span class="sc">$</span>common_cols <span class="ot">-&gt;</span> primarykeys_tickets_airports_flights</span>
<span id="cb22-3"><a href="#cb22-3"></a></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="co"># Join med large round trip routes to tickets data</span></span>
<span id="cb22-5"><a href="#cb22-5"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb22-6"><a href="#cb22-6"></a>  <span class="fu">left_join</span>(ticketsround_summary,</span>
<span id="cb22-7"><a href="#cb22-7"></a>            <span class="at">by =</span> <span class="fu">c</span>(primarykeys_tickets_airports_flights)) <span class="sc">|&gt;</span> </span>
<span id="cb22-8"><a href="#cb22-8"></a>  <span class="do">## Impute Mean/Median of route (across all carriers) where possible</span></span>
<span id="cb22-9"><a href="#cb22-9"></a>  <span class="fu">mutate</span>(<span class="at">avg_fare_imputed =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(avg_fare),</span>
<span id="cb22-10"><a href="#cb22-10"></a>                                    <span class="fu">roundmean</span>(avg_fare, <span class="at">na.rm =</span> T),</span>
<span id="cb22-11"><a href="#cb22-11"></a>                                    avg_fare),</span>
<span id="cb22-12"><a href="#cb22-12"></a>         <span class="at">med_fare_imputed =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(med_fare),</span>
<span id="cb22-13"><a href="#cb22-13"></a>                                    <span class="fu">median</span>(med_fare, <span class="at">na.rm =</span> T),</span>
<span id="cb22-14"><a href="#cb22-14"></a>                                    med_fare),</span>
<span id="cb22-15"><a href="#cb22-15"></a>         <span class="at">.by =</span> <span class="fu">c</span>(route_iata)) <span class="ot">-&gt;</span> flights_medlarge_roundtrip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Lastly, a quick validation check shows that none of the <code>routes</code> that still have missing <code>ticket_fare</code> values are in the top 50 busiest <code>routes</code></p>
<ul>
<li>the lack of output indicates there were no top 50 routes that matched the <code>NA</code> <code>ticket_fare</code> criteria</li>
</ul>
<p>As <code>ticket_fares</code> are needed for profitability, and the removal impact is likely to be minimal, the remaining records with missing values were removed.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># Top 50 Routes</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">count</span>(origin_iata_leg1, destin_iata_leg1,route_iata, <span class="at">sort =</span> T) <span class="sc">|&gt;</span> </span>
<span id="cb23-4"><a href="#cb23-4"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">50</span>) <span class="ot">-&gt;</span> top50routes</span>
<span id="cb23-5"><a href="#cb23-5"></a></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="co"># Check if any flights missing ticket fares are in top 50 busiest (NO)</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb23-8"><a href="#cb23-8"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(med_fare_imputed)) <span class="sc">|&gt;</span> </span>
<span id="cb23-9"><a href="#cb23-9"></a>  <span class="fu">inner_join</span>(top50routes)</span>
<span id="cb23-10"><a href="#cb23-10"></a></span>
<span id="cb23-11"><a href="#cb23-11"></a><span class="co"># Remove remaining NA</span></span>
<span id="cb23-12"><a href="#cb23-12"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(med_fare_imputed)) <span class="ot">-&gt;</span> flights_medlarge_roundtrip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section></section><section id="profitability-calculations" class="level1"><h1>Profitability Calculations</h1>
<p>The last step is to calculate the <code>cost</code>, <code>revenue</code>, and <code>profit</code> for each flight, which will allow for analytical aggregation up to the <code>route</code> and <code>carrier</code> level. To facilitate data exploration and validation, profitability metrics are calculated for both the individual legs and the overall round-trip flight.</p>
<section id="revenue" class="level2"><h2 class="anchored" data-anchor-id="revenue">Revenue</h2>
<p>Revenue is comprised of <code>ticket_fare</code> and <code>baggage_fee</code> components, both of which are impacted by <code>passenger_counts</code>. To derive <code>passenger_counts</code>, the <code>occupancy_rates</code> are multiplied by an assumed max capacity of 200 passengers. These <code>passenger_counts</code>in turn serve as multipliers for the <code>median_ticket_fare</code> and <code>baggage_fee</code> calculations.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># TICKET Fees = Median Fare * Estimated Passenger Count</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">mutate</span>(<span class="at">n_passengers_leg1 =</span> occupancy_rate_leg1<span class="sc">*</span><span class="dv">200</span>,</span>
<span id="cb24-4"><a href="#cb24-4"></a>         <span class="at">n_passengers_leg2 =</span> occupancy_rate_leg2<span class="sc">*</span><span class="dv">200</span>,</span>
<span id="cb24-5"><a href="#cb24-5"></a>         <span class="at">n_passengers_total =</span> n_passengers_leg1 <span class="sc">+</span> n_passengers_leg1,</span>
<span id="cb24-6"><a href="#cb24-6"></a>         <span class="at">avg_occ_rate_bothlegs =</span> <span class="fu">round</span>(n_passengers_total<span class="sc">/</span><span class="dv">400</span>, <span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb24-7"><a href="#cb24-7"></a>  <span class="fu">mutate</span>(<span class="at">est_fare_revenue_total =</span> n_passengers_total<span class="sc">*</span>med_fare_imputed) <span class="sc">|&gt;</span> </span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="co"># Baggage Fees = $35 * Total Number Passengers * 0.5 bags per passenger</span></span>
<span id="cb24-9"><a href="#cb24-9"></a>  <span class="fu">mutate</span>(<span class="at">n_bags_leg1 =</span> n_passengers_leg1<span class="sc">*</span><span class="fl">0.5</span>,</span>
<span id="cb24-10"><a href="#cb24-10"></a>         <span class="at">n_bags_leg2 =</span> n_passengers_leg2<span class="sc">*</span><span class="fl">0.5</span>,</span>
<span id="cb24-11"><a href="#cb24-11"></a>         <span class="at">n_bags_total =</span> n_passengers_leg1 <span class="sc">+</span> n_passengers_leg2,</span>
<span id="cb24-12"><a href="#cb24-12"></a>         <span class="at">est_bag_revenue_total =</span> n_bags_total<span class="sc">*</span><span class="dv">35</span>) <span class="sc">|&gt;</span> </span>
<span id="cb24-13"><a href="#cb24-13"></a>  <span class="co"># Total Revenue Calc = Bag Rev + Fare Rev</span></span>
<span id="cb24-14"><a href="#cb24-14"></a>  <span class="fu">mutate</span>(<span class="at">est_all_revenue_total =</span> est_bag_revenue_total <span class="sc">+</span> est_fare_revenue_total) <span class="ot">-&gt;</span> flights_medlarge_roundtrip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="costs" class="level2"><h2 class="anchored" data-anchor-id="costs">Costs</h2>
<p>Costs are comprised of <code>mileage_variable</code>, <code>airport_size</code>, and <code>delay_time</code> components. The <code>mileage_variable</code> costs are determined by an assumed $9.18 fee per <code>distance</code> mile traveled and the <code>airport_size</code> costs are based on a $5k/$10k charge for medium/large airports. The <code>delay_time</code> costs are based on a $75/min charge applied to each <code>arrival</code> and <code>departure</code> for each minute of <code>delay_time</code> past a 15-minute grace period.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Mileage-variable costs</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">mutate</span>(<span class="at">mileage_var_costs_leg1 =</span> <span class="fl">9.18</span><span class="sc">*</span>distance_leg1,</span>
<span id="cb25-4"><a href="#cb25-4"></a>         <span class="at">mileage_var_costs_leg2 =</span> <span class="fl">9.18</span><span class="sc">*</span>distance_leg2,</span>
<span id="cb25-5"><a href="#cb25-5"></a>         <span class="at">mileage_var_costs_total =</span> mileage_var_costs_leg1 <span class="sc">+</span> mileage_var_costs_leg2) <span class="sc">|&gt;</span> </span>
<span id="cb25-6"><a href="#cb25-6"></a>  <span class="co"># Airport Cost = if med then 5k, if large then 10k</span></span>
<span id="cb25-7"><a href="#cb25-7"></a>  <span class="fu">mutate</span>(<span class="at">destin_airport_cost_leg1 =</span> <span class="fu">if_else</span>(destin_type_leg1 <span class="sc">==</span> <span class="st">"large_airport"</span>,</span>
<span id="cb25-8"><a href="#cb25-8"></a>                                            <span class="at">true =</span> <span class="dv">10000</span>,</span>
<span id="cb25-9"><a href="#cb25-9"></a>                                            <span class="at">false =</span> <span class="dv">5000</span>),</span>
<span id="cb25-10"><a href="#cb25-10"></a>         <span class="at">destin_airport_cost_leg2 =</span> <span class="fu">if_else</span>(destin_type_leg2 <span class="sc">==</span> <span class="st">"large_airport"</span>,</span>
<span id="cb25-11"><a href="#cb25-11"></a>                                            <span class="at">true =</span> <span class="dv">10000</span>,</span>
<span id="cb25-12"><a href="#cb25-12"></a>                                            <span class="at">false =</span> <span class="dv">5000</span>),</span>
<span id="cb25-13"><a href="#cb25-13"></a>         <span class="at">airport_landing_cost_total =</span> destin_airport_cost_leg1 <span class="sc">+</span> destin_airport_cost_leg2) <span class="sc">|&gt;</span> </span>
<span id="cb25-14"><a href="#cb25-14"></a>  <span class="co"># Departure/Arrival Delay &gt; 15min = $75/min</span></span>
<span id="cb25-15"><a href="#cb25-15"></a>  <span class="co"># Subtract 15min grace period from all 4 flight legs</span></span>
<span id="cb25-16"><a href="#cb25-16"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">contains</span>(<span class="st">"delay"</span>),</span>
<span id="cb25-17"><a href="#cb25-17"></a>                <span class="at">.fns =</span> <span class="sc">~</span>.x<span class="dv">-15</span>,</span>
<span id="cb25-18"><a href="#cb25-18"></a>                <span class="at">.names =</span> <span class="st">"{.col}_adj"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb25-19"><a href="#cb25-19"></a>  <span class="co"># Zero trunc adjusted delay time for all 4 flight legs</span></span>
<span id="cb25-20"><a href="#cb25-20"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">contains</span>(<span class="st">"_adj"</span>),</span>
<span id="cb25-21"><a href="#cb25-21"></a>                <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">zero_trunc</span>(.x))) <span class="sc">|&gt;</span> </span>
<span id="cb25-22"><a href="#cb25-22"></a>  <span class="co"># Total adjusted delay time summed across all 4 flight legs</span></span>
<span id="cb25-23"><a href="#cb25-23"></a>  <span class="fu">mutate</span>(<span class="at">arr_dep_delay_time_total =</span> (dep_delay_leg1_adj <span class="sc">+</span></span>
<span id="cb25-24"><a href="#cb25-24"></a>                                       arr_delay_leg1_adj <span class="sc">+</span></span>
<span id="cb25-25"><a href="#cb25-25"></a>                                       dep_delay_leg2_adj <span class="sc">+</span></span>
<span id="cb25-26"><a href="#cb25-26"></a>                                       arr_delay_leg2_adj)) <span class="sc">|&gt;</span> </span>
<span id="cb25-27"><a href="#cb25-27"></a>  <span class="co"># Delay costs based on adjusted delay times for all 4 flight legs</span></span>
<span id="cb25-28"><a href="#cb25-28"></a>  <span class="fu">mutate</span>(<span class="at">dep_delay_cost_leg1 =</span> dep_delay_leg1_adj<span class="sc">*</span><span class="dv">75</span>,</span>
<span id="cb25-29"><a href="#cb25-29"></a>         <span class="at">arr_delay_cost_leg1 =</span> arr_delay_leg1_adj<span class="sc">*</span><span class="dv">75</span>, </span>
<span id="cb25-30"><a href="#cb25-30"></a>         <span class="at">dep_delay_cost_leg2 =</span> dep_delay_leg2_adj<span class="sc">*</span><span class="dv">75</span>, </span>
<span id="cb25-31"><a href="#cb25-31"></a>         <span class="at">arr_delay_cost_leg2 =</span> arr_delay_leg2_adj<span class="sc">*</span><span class="dv">75</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-32"><a href="#cb25-32"></a>  <span class="co"># Total delay cost based on summing across delay costs for 4 legs</span></span>
<span id="cb25-33"><a href="#cb25-33"></a>  <span class="fu">mutate</span>(<span class="at">arr_dep_delay_cost_total =</span> (dep_delay_cost_leg1 <span class="sc">+</span></span>
<span id="cb25-34"><a href="#cb25-34"></a>                                       dep_delay_cost_leg2 <span class="sc">+</span></span>
<span id="cb25-35"><a href="#cb25-35"></a>                                       arr_delay_cost_leg1 <span class="sc">+</span></span>
<span id="cb25-36"><a href="#cb25-36"></a>                                       arr_delay_cost_leg2)) <span class="sc">|&gt;</span> </span>
<span id="cb25-37"><a href="#cb25-37"></a><span class="co"># Total Costs = milage variable + airport + delay</span></span>
<span id="cb25-38"><a href="#cb25-38"></a>  <span class="fu">mutate</span>(<span class="at">est_all_costs_total =</span> mileage_var_costs_total <span class="sc">+</span></span>
<span id="cb25-39"><a href="#cb25-39"></a>           airport_landing_cost_total <span class="sc">+</span></span>
<span id="cb25-40"><a href="#cb25-40"></a>           arr_dep_delay_cost_total) <span class="ot">-&gt;</span> flights_medlarge_roundtrip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section><section id="profit" class="level2"><h2 class="anchored" data-anchor-id="profit">Profit</h2>
<p>Profit is calculated for each individual round-trip flight by subtracting the flight-level <code>total_costs</code> from the <code>total_revenue</code>.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Total Profit = Total Revenue - Total Cost</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">mutate</span>(<span class="at">est_profit_total =</span> est_all_revenue_total <span class="sc">-</span> est_all_costs_total) <span class="ot">-&gt;</span> flights_medlarge_roundtrip</span>
<span id="cb26-4"><a href="#cb26-4"></a></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="co"># Validate</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb26-7"><a href="#cb26-7"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-8"><a href="#cb26-8"></a>  <span class="fu">select</span>(route_iata,op_carrier,tail_num, est_profit_total,est_all_revenue_total,est_all_costs_total) <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb26-9"><a href="#cb26-9"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Validation Sample of Flight-Level Profit Metrics**"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="bmxijzzbuf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#bmxijzzbuf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#bmxijzzbuf thead, #bmxijzzbuf tbody, #bmxijzzbuf tfoot, #bmxijzzbuf tr, #bmxijzzbuf td, #bmxijzzbuf th {
  border-style: none;
}

#bmxijzzbuf p {
  margin: 0;
  padding: 0;
}

#bmxijzzbuf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#bmxijzzbuf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#bmxijzzbuf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#bmxijzzbuf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#bmxijzzbuf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bmxijzzbuf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bmxijzzbuf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bmxijzzbuf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bmxijzzbuf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bmxijzzbuf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bmxijzzbuf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bmxijzzbuf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bmxijzzbuf .gt_spanner_row {
  border-bottom-style: hidden;
}

#bmxijzzbuf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#bmxijzzbuf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bmxijzzbuf .gt_from_md > :first-child {
  margin-top: 0;
}

#bmxijzzbuf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bmxijzzbuf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bmxijzzbuf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#bmxijzzbuf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#bmxijzzbuf .gt_row_group_first td {
  border-top-width: 2px;
}

#bmxijzzbuf .gt_row_group_first th {
  border-top-width: 2px;
}

#bmxijzzbuf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bmxijzzbuf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#bmxijzzbuf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#bmxijzzbuf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bmxijzzbuf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bmxijzzbuf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bmxijzzbuf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#bmxijzzbuf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bmxijzzbuf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bmxijzzbuf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bmxijzzbuf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bmxijzzbuf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bmxijzzbuf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bmxijzzbuf .gt_left {
  text-align: left;
}

#bmxijzzbuf .gt_center {
  text-align: center;
}

#bmxijzzbuf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bmxijzzbuf .gt_font_normal {
  font-weight: normal;
}

#bmxijzzbuf .gt_font_bold {
  font-weight: bold;
}

#bmxijzzbuf .gt_font_italic {
  font-style: italic;
}

#bmxijzzbuf .gt_super {
  font-size: 65%;
}

#bmxijzzbuf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#bmxijzzbuf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#bmxijzzbuf .gt_indent_1 {
  text-indent: 5px;
}

#bmxijzzbuf .gt_indent_2 {
  text-indent: 10px;
}

#bmxijzzbuf .gt_indent_3 {
  text-indent: 15px;
}

#bmxijzzbuf .gt_indent_4 {
  text-indent: 20px;
}

#bmxijzzbuf .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="6" class="gt_heading gt_title gt_font_normal gt_bottom_border" style=""><strong>Validation Sample of Flight-Level Profit Metrics</strong></td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="route_iata">route_iata</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="op_carrier">op_carrier</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="tail_num">tail_num</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="est_profit_total">est_profit_total</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="est_all_revenue_total">est_all_revenue_total</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="est_all_costs_total">est_all_costs_total</th>
    </tr>
</thead>
<tbody class="gt_table_body"><tr>
<td headers="route_iata" class="gt_row gt_left">FLL-PHL</td>
<td headers="op_carrier" class="gt_row gt_left">AA</td>
<td headers="tail_num" class="gt_row gt_left">N121UW</td>
<td headers="est_profit_total" class="gt_row gt_right">40664.88</td>
<td headers="est_all_revenue_total" class="gt_row gt_right">78878</td>
<td headers="est_all_costs_total" class="gt_row gt_right">38213.12</td>
</tr></tbody>
</table>
</div>
</div>
</div>
</section></section><section id="findings" class="level1"><h1>Findings</h1>
<p>We can now use our final dataset to evaluate each <code>route</code> and/or <code>route/carrier</code> combo using a variety of KPIs.</p>
<section id="top-10-busiest-routes" class="level2"><h2 class="anchored" data-anchor-id="top-10-busiest-routes">Top 10 Busiest Routes</h2>
<p>At the <code>route</code>-level, we can see in <a href="#fig-top10busiest_routes">Figure&nbsp;7</a> that the <code>LA-SanFran</code> (<code>LAX-SFO</code>) route was the busiest overall route in 1Q2019, followed closely by a number of routes based out of <code>Atlanta</code>.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="do">## Top 10 Flights Bar Chart</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="do">### Round</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="fu">singlebar_viz</span>(<span class="at">x =</span> route_iata, <span class="at">nrecs =</span> <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Route"</span>,</span>
<span id="cb27-6"><a href="#cb27-6"></a>       <span class="at">title =</span> <span class="st">"Top 10 Busiest Routes &amp; Flights Recorded in 1Q2019"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-top10busiest_routes" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Flights-Analysis_files/figure-html/fig-top10busiest_routes-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;7: Routes with the greatest number of flights</figcaption></figure>
</div>
</div>
</div>
<p>Further, when just the originating airport is considered, <a href="#fig-top10busiest_originating">Figure&nbsp;8</a> shows that the overwhelming majority of <em>all</em> round-trip routes originated out of Atlanta (<code>ATL</code>), with Dallas-Fort Worth (<code>DFW</code>) and Charlotte (<code>CLT</code>) coming in 2nd and 3rd. We also see clear <code>carrier</code>-<code>origin_hub</code> patterns, with <code>Delta</code> dominating <code>Atlanta</code> and American Airlines and its subsidiaries covering <code>Charlotte</code> and <code>Dallas-Fort Worth</code>.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">doublebar_viz</span>(<span class="at">x =</span> origin_iata_leg1,<span class="at">grp1 =</span> op_carrier, <span class="at">nrecs =</span> <span class="dv">10</span>, <span class="at">labels =</span> F) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Originating Hub"</span>, <span class="at">y =</span> <span class="st">"Flights"</span>, <span class="at">fill =</span> <span class="st">"Carrier"</span>,</span>
<span id="cb28-4"><a href="#cb28-4"></a>       <span class="at">title =</span> <span class="st">"Delta's Atlanta and AA's Charlotte/Dallas Hubs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-top10busiest_originating" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Flights-Analysis_files/figure-html/fig-top10busiest_originating-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;8: Originating airports with greatest number of flights</figcaption></figure>
</div>
</div>
</div>
<p>Accordingly, <code>route/carrier</code> combinations were probed to see which routes operated by specific carriers were the busiest. As shown below in <a href="#fig-top10busiest_both">Figure&nbsp;9</a>, <code>Delta</code> (<code>DL</code>) had the greatest number of 1Q2019 flights by far, the majority of which originated out of its main hub in <code>Atlanta (ATL)</code>. Interestingly, there were no individual <code>route/carrier</code> combinations that appeared overwhelmingly busier.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2"></a>  <span class="fu">doublebar_viz</span>(<span class="at">x =</span> op_carrier,<span class="at">grp1 =</span> route_iata, <span class="at">nrecs =</span> <span class="dv">10</span>, <span class="at">labels =</span> F) <span class="sc">+</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Carrier"</span>, <span class="at">y =</span> <span class="st">"Flights"</span>, <span class="at">fill =</span> <span class="st">"Route"</span>,</span>
<span id="cb29-4"><a href="#cb29-4"></a>       <span class="at">title =</span> <span class="st">"Delta's Atlanta-based Round-Trip Routes were Busiest by Far"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-top10busiest_both" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Flights-Analysis_files/figure-html/fig-top10busiest_both-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;9: Route-Carrier combos with greatest number of flights</figcaption></figure>
</div>
</div>
</div>
</section><section id="top-10-profitable-routes" class="level2"><h2 class="anchored" data-anchor-id="top-10-profitable-routes">Top 10 Profitable Routes</h2>
<p>In orderto probe high-level profitability, estimates for each individual round-trip flight were aggregated across <code>routes</code> and <code>route/carrier</code> combinations. The <code>route</code> and <code>route/carrier</code>-level profit estimates were then rank-ordered to derive the top 10 results.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The following profitability estimates represent two levels of summary data, as first the group-wise median fares were imputed for flight-level estimates tjat were then averaged again to create route-level profitability
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<section id="routes" class="level3"><h3 class="anchored" data-anchor-id="routes">Routes</h3>
<p>As seen in <a href="#fig-top10profit_routes">Figure&nbsp;10</a>, while most of the top 10 routes generate an average profit of between $150,000 to $250,000, the <code>Vail, CO - New York</code> route (<code>EGE - JFK</code>) is a significant outlier that generates an average profit of over $500,000.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span>
<span id="cb30-2"><a href="#cb30-2"></a></span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="co"># 10 Profitable Routes - Summary</span></span>
<span id="cb30-4"><a href="#cb30-4"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="fu">flightdicer</span>(<span class="at">grp1 =</span> route_iata,</span>
<span id="cb30-6"><a href="#cb30-6"></a>             <span class="co"># grp2 = op_carrier,</span></span>
<span id="cb30-7"><a href="#cb30-7"></a>              <span class="at">min_flights =</span> <span class="dv">20</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-8"><a href="#cb30-8"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_profit)) <span class="sc">|&gt;</span> </span>
<span id="cb30-9"><a href="#cb30-9"></a>  <span class="fu">mutate</span>(<span class="at">rank_profit =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb30-10"><a href="#cb30-10"></a>  <span class="fu">slice_max</span>(avg_profit, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb30-11"><a href="#cb30-11"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> (<span class="fu">where</span>(is.numeric) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">contains</span>(<span class="st">"occ"</span>)),</span>
<span id="cb30-12"><a href="#cb30-12"></a>                <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">round</span>(.x))) <span class="ot">-&gt;</span> top10routes_profit_summary</span>
<span id="cb30-13"><a href="#cb30-13"></a></span>
<span id="cb30-14"><a href="#cb30-14"></a><span class="co"># Isolate just the routes for later comparisons</span></span>
<span id="cb30-15"><a href="#cb30-15"></a>top10routes_profit_summary <span class="sc">|&gt;</span> <span class="fu">pull</span>(route_iata) <span class="ot">-&gt;</span> top10routes_profit</span>
<span id="cb30-16"><a href="#cb30-16"></a></span>
<span id="cb30-17"><a href="#cb30-17"></a><span class="co"># Viz</span></span>
<span id="cb30-18"><a href="#cb30-18"></a>top10routes_profit_summary <span class="sc">|&gt;</span> </span>
<span id="cb30-19"><a href="#cb30-19"></a>  <span class="fu">doublebox_viz</span>(<span class="at">x =</span> route_iata,</span>
<span id="cb30-20"><a href="#cb30-20"></a>                <span class="at">y =</span> avg_profit) <span class="sc">+</span></span>
<span id="cb30-21"><a href="#cb30-21"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Route"</span>,</span>
<span id="cb30-22"><a href="#cb30-22"></a>       <span class="at">y =</span> <span class="st">"Avg Profit"</span>) <span class="sc">+</span></span>
<span id="cb30-23"><a href="#cb30-23"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">600000</span>, <span class="at">by =</span> <span class="dv">50000</span>),</span>
<span id="cb30-24"><a href="#cb30-24"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">600000</span>),</span>
<span id="cb30-25"><a href="#cb30-25"></a>                     <span class="at">labels =</span> \(x) <span class="fu">paste0</span>(<span class="st">"$"</span>, x)) <span class="sc">+</span></span>
<span id="cb30-26"><a href="#cb30-26"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-top10profit_routes" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Flights-Analysis_files/figure-html/fig-top10profit_routes-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;10: Top 10 routes by average profit</figcaption></figure>
</div>
</div>
</div>
<p>This generates 2 follow-up questions:</p>
<ol type="1">
<li>What is unique about the outlier <code>EGE-JFK</code> (<code>Vail, CO - New York</code>) route?</li>
<li>Is there significant variation across <code>carriers</code> within specific <code>routes</code>?
<ol type="1">
<li>e.g.&nbsp;Is a <code>route</code>-level estimate reliable?</li>
</ol>
</li>
</ol>
<section id="vail-co---new-york" class="level4"><h4 class="anchored" data-anchor-id="vail-co---new-york">Vail, CO - New York</h4>
<p>When comparing the <code>EGE-JFK</code> route to the other Top 10 profitable routes, <a href="#tbl-vail_NY_vs_other_top10">Table&nbsp;1</a> below shows us that:</p>
<ul>
<li><p><code>Vail-NY</code> is a much lower-volume route, as while the <code>passenger_counts</code> are roughly equivalent, the total number of 1Q2019 <code>recorded_flights</code> is only 20% of the average flight count for the other top 10 routes</p></li>
<li><p><code>Vail-NY</code> flights cost about $25,000 more per flight on average, but generate <strong>$350,000 more in average revenue</strong> than the other Top 10 routes!</p></li>
</ul>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># Create flag separating JFK-Vail route from other top 10 and get stats</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>top10routes_profit_summary <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="fu">mutate</span>(<span class="at">route_jfk_ege =</span> <span class="fu">if_else</span>(route_iata <span class="sc">==</span> <span class="st">"EGE-JFK"</span>,</span>
<span id="cb31-4"><a href="#cb31-4"></a>                                 <span class="st">"Vail - NYC"</span>,</span>
<span id="cb31-5"><a href="#cb31-5"></a>                                 <span class="st">"Other"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric),</span>
<span id="cb31-7"><a href="#cb31-7"></a>                   <span class="sc">~</span><span class="fu">roundmean</span>(.x, <span class="at">digits =</span> <span class="dv">0</span>)),</span>
<span id="cb31-8"><a href="#cb31-8"></a>            <span class="at">.by =</span> route_jfk_ege) <span class="sc">|&gt;</span> </span>
<span id="cb31-9"><a href="#cb31-9"></a>  <span class="fu">select</span>(route_jfk_ege, n_flights, avg_profit,</span>
<span id="cb31-10"><a href="#cb31-10"></a>         avg_n_passengers,avg_cost_total, avg_revenue_total) <span class="sc">|&gt;</span> </span>
<span id="cb31-11"><a href="#cb31-11"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb31-12"><a href="#cb31-12"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Vail - NY has Greater Revenue than other Top 10**"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="tbl-vail_NY_vs_other_top10" class="anchored">

<div id="jlezfovggb" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#jlezfovggb table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#jlezfovggb thead, #jlezfovggb tbody, #jlezfovggb tfoot, #jlezfovggb tr, #jlezfovggb td, #jlezfovggb th {
  border-style: none;
}

#jlezfovggb p {
  margin: 0;
  padding: 0;
}

#jlezfovggb .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jlezfovggb .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#jlezfovggb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jlezfovggb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jlezfovggb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jlezfovggb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jlezfovggb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jlezfovggb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jlezfovggb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jlezfovggb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jlezfovggb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jlezfovggb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jlezfovggb .gt_spanner_row {
  border-bottom-style: hidden;
}

#jlezfovggb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#jlezfovggb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jlezfovggb .gt_from_md > :first-child {
  margin-top: 0;
}

#jlezfovggb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jlezfovggb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jlezfovggb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#jlezfovggb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jlezfovggb .gt_row_group_first td {
  border-top-width: 2px;
}

#jlezfovggb .gt_row_group_first th {
  border-top-width: 2px;
}

#jlezfovggb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jlezfovggb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#jlezfovggb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jlezfovggb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jlezfovggb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jlezfovggb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jlezfovggb .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#jlezfovggb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jlezfovggb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jlezfovggb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jlezfovggb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jlezfovggb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jlezfovggb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jlezfovggb .gt_left {
  text-align: left;
}

#jlezfovggb .gt_center {
  text-align: center;
}

#jlezfovggb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jlezfovggb .gt_font_normal {
  font-weight: normal;
}

#jlezfovggb .gt_font_bold {
  font-weight: bold;
}

#jlezfovggb .gt_font_italic {
  font-style: italic;
}

#jlezfovggb .gt_super {
  font-size: 65%;
}

#jlezfovggb .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#jlezfovggb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jlezfovggb .gt_indent_1 {
  text-indent: 5px;
}

#jlezfovggb .gt_indent_2 {
  text-indent: 10px;
}

#jlezfovggb .gt_indent_3 {
  text-indent: 15px;
}

#jlezfovggb .gt_indent_4 {
  text-indent: 20px;
}

#jlezfovggb .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<caption>Table&nbsp;1:  <p>Vail - NY route vs other Top 10 routes</p> </caption>
  <thead>
<tr class="gt_heading">
<td colspan="6" class="gt_heading gt_title gt_font_normal gt_bottom_border" style=""><strong>Vail - NY has Greater Revenue than other Top 10</strong></td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="route_jfk_ege">route_jfk_ege</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="n_flights">n_flights</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_profit">avg_profit</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_n_passengers">avg_n_passengers</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_cost_total">avg_cost_total</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_revenue_total">avg_revenue_total</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr>
<td headers="route_jfk_ege" class="gt_row gt_left">Vail - NYC</td>
<td headers="n_flights" class="gt_row gt_right">54</td>
<td headers="avg_profit" class="gt_row gt_right">512848</td>
<td headers="avg_n_passengers" class="gt_row gt_right">249</td>
<td headers="avg_cost_total" class="gt_row gt_right">51595</td>
<td headers="avg_revenue_total" class="gt_row gt_right">564443</td>
</tr>
<tr>
<td headers="route_jfk_ege" class="gt_row gt_left">Other</td>
<td headers="n_flights" class="gt_row gt_right">243</td>
<td headers="avg_profit" class="gt_row gt_right">185361</td>
<td headers="avg_n_passengers" class="gt_row gt_right">258</td>
<td headers="avg_cost_total" class="gt_row gt_right">27279</td>
<td headers="avg_revenue_total" class="gt_row gt_right">212640</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<p>Further, as seen below, the main driver in this revenue gap is the <code>ticket_fares</code> charged, with the <code>Vail-NY</code> route charging over 3x the other top 10 routes per passenger on average.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co">#| label: tbl-vail_revenue_diffs</span></span>
<span id="cb32-2"><a href="#cb32-2"></a></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="co"># Create flag separating JFK-Vail route and get revenue info</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>top10routes_profit_summary <span class="sc">|&gt;</span> </span>
<span id="cb32-5"><a href="#cb32-5"></a>  <span class="fu">mutate</span>(<span class="at">route_jfk_ege =</span> <span class="fu">if_else</span>(route_iata <span class="sc">==</span> <span class="st">"EGE-JFK"</span>,</span>
<span id="cb32-6"><a href="#cb32-6"></a>                                 <span class="st">"Vail - NYC"</span>,</span>
<span id="cb32-7"><a href="#cb32-7"></a>                                 <span class="st">"Other"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb32-8"><a href="#cb32-8"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb32-9"><a href="#cb32-9"></a>                   <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">roundmean</span>(.x, <span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb32-10"><a href="#cb32-10"></a>            <span class="at">.by =</span> route_jfk_ege) <span class="sc">|&gt;</span> </span>
<span id="cb32-11"><a href="#cb32-11"></a>  <span class="fu">select</span>(route_jfk_ege, avg_occupancy_rate, avg_bag_revenue,</span>
<span id="cb32-12"><a href="#cb32-12"></a>         avg_fare_revenue,avg_median_fare) <span class="sc">|&gt;</span> </span>
<span id="cb32-13"><a href="#cb32-13"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb32-14"><a href="#cb32-14"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Vail - NY has 3x Higher Ticket Fares than other Top 10**"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="inybtjjtno" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#inybtjjtno table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#inybtjjtno thead, #inybtjjtno tbody, #inybtjjtno tfoot, #inybtjjtno tr, #inybtjjtno td, #inybtjjtno th {
  border-style: none;
}

#inybtjjtno p {
  margin: 0;
  padding: 0;
}

#inybtjjtno .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#inybtjjtno .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#inybtjjtno .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#inybtjjtno .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#inybtjjtno .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#inybtjjtno .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#inybtjjtno .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#inybtjjtno .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#inybtjjtno .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#inybtjjtno .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#inybtjjtno .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#inybtjjtno .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#inybtjjtno .gt_spanner_row {
  border-bottom-style: hidden;
}

#inybtjjtno .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#inybtjjtno .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#inybtjjtno .gt_from_md > :first-child {
  margin-top: 0;
}

#inybtjjtno .gt_from_md > :last-child {
  margin-bottom: 0;
}

#inybtjjtno .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#inybtjjtno .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#inybtjjtno .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#inybtjjtno .gt_row_group_first td {
  border-top-width: 2px;
}

#inybtjjtno .gt_row_group_first th {
  border-top-width: 2px;
}

#inybtjjtno .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#inybtjjtno .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#inybtjjtno .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#inybtjjtno .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#inybtjjtno .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#inybtjjtno .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#inybtjjtno .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#inybtjjtno .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#inybtjjtno .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#inybtjjtno .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#inybtjjtno .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#inybtjjtno .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#inybtjjtno .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#inybtjjtno .gt_left {
  text-align: left;
}

#inybtjjtno .gt_center {
  text-align: center;
}

#inybtjjtno .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#inybtjjtno .gt_font_normal {
  font-weight: normal;
}

#inybtjjtno .gt_font_bold {
  font-weight: bold;
}

#inybtjjtno .gt_font_italic {
  font-style: italic;
}

#inybtjjtno .gt_super {
  font-size: 65%;
}

#inybtjjtno .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#inybtjjtno .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#inybtjjtno .gt_indent_1 {
  text-indent: 5px;
}

#inybtjjtno .gt_indent_2 {
  text-indent: 10px;
}

#inybtjjtno .gt_indent_3 {
  text-indent: 15px;
}

#inybtjjtno .gt_indent_4 {
  text-indent: 20px;
}

#inybtjjtno .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="5" class="gt_heading gt_title gt_font_normal gt_bottom_border" style=""><strong>Vail - NY has 3x Higher Ticket Fares than other Top 10</strong></td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="route_jfk_ege">route_jfk_ege</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_occupancy_rate">avg_occupancy_rate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_bag_revenue">avg_bag_revenue</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_fare_revenue">avg_fare_revenue</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_median_fare">avg_median_fare</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr>
<td headers="route_jfk_ege" class="gt_row gt_left">Vail - NYC</td>
<td headers="avg_occupancy_rate" class="gt_row gt_right">0.62</td>
<td headers="avg_bag_revenue" class="gt_row gt_right">9094</td>
<td headers="avg_fare_revenue" class="gt_row gt_right">555350</td>
<td headers="avg_median_fare" class="gt_row gt_right">2228.00</td>
</tr>
<tr>
<td headers="route_jfk_ege" class="gt_row gt_left">Other</td>
<td headers="avg_occupancy_rate" class="gt_row gt_right">0.65</td>
<td headers="avg_bag_revenue" class="gt_row gt_right">9046</td>
<td headers="avg_fare_revenue" class="gt_row gt_right">203594</td>
<td headers="avg_median_fare" class="gt_row gt_right">788.44</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="carrier-variability" class="level4"><h4 class="anchored" data-anchor-id="carrier-variability">Carrier Variability</h4>
<p>Having determined that fare prices can be a significant driver of profit, particularly for low-volume routes, we now turn to Question 2 to probe possible profitability variations across <code>carriers</code> for these top 10 overall <code>routes</code>. As seen in <a href="#fig-top10profit_route_carrier_probe">Figure&nbsp;11</a>, the following top 10 overall routes do have significant differences across carriers:</p>
<ul>
<li><p><code>Cincinatti-Detroit</code> (<code>CVG-DTW)</code></p></li>
<li><p><code>Charlotte-Wilmington</code> (<code>CLT-ILM</code>)</p></li>
<li><p><code>Atlanta-Columbus, MS</code> <code>(ATL-GTR)</code></p></li>
</ul>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Filter for those top 10 profitable routes and examine inter-carrier variation</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">filter</span>(route_iata <span class="sc">%in%</span> top10routes_profit) <span class="sc">|&gt;</span> </span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> route_iata,</span>
<span id="cb33-5"><a href="#cb33-5"></a>             <span class="at">fill =</span> op_carrier,</span>
<span id="cb33-6"><a href="#cb33-6"></a>             <span class="at">y =</span> est_profit_total)) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb33-8"><a href="#cb33-8"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb33-10"><a href="#cb33-10"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb33-11"><a href="#cb33-11"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb33-12"><a href="#cb33-12"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"firebrick"</span>),</span>
<span id="cb33-13"><a href="#cb33-13"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)) <span class="sc">+</span></span>
<span id="cb33-14"><a href="#cb33-14"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Profit ($) per Round Trip Flight"</span>,</span>
<span id="cb33-15"><a href="#cb33-15"></a>       <span class="at">fill =</span> <span class="st">"Carrier"</span>,</span>
<span id="cb33-16"><a href="#cb33-16"></a>       <span class="at">x =</span> <span class="st">"Route"</span>,</span>
<span id="cb33-17"><a href="#cb33-17"></a>       <span class="at">title =</span> <span class="st">"Top 10 Most Profitable Routes Overall"</span>,</span>
<span id="cb33-18"><a href="#cb33-18"></a>       <span class="at">subtitle =</span> <span class="st">"Variation in Profitability by Carrier"</span>,</span>
<span id="cb33-19"><a href="#cb33-19"></a>       <span class="at">caption =</span> <span class="st">"Only routes w/20+ flights recorded included in profitability"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-top10profit_route_carrier_probe" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Flights-Analysis_files/figure-html/fig-top10profit_route_carrier_probe-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;11: Carrier variability for top 10 profitable routes</figcaption></figure>
</div>
</div>
</div>
<p>This is significant because it suggests that:</p>
<ul>
<li><p>Not all carriers experience the same profitability on these Top 10 routes</p></li>
<li><p>There may be other routes that provide even greater profitability for specific carriers</p></li>
</ul></section></section><section id="routes-carriers" class="level3"><h3 class="anchored" data-anchor-id="routes-carriers">Routes &amp; Carriers</h3>
<p>Given the inter-carrier variability in profit that was observed, profitability statistics were next calculated for specific <code>route/carrier</code> combos.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># 10 proftiable Route/Carrier Combos - Summary Stats</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb34-3"><a href="#cb34-3"></a>  <span class="fu">flightdicer</span>(<span class="at">grp1 =</span> route_iata,</span>
<span id="cb34-4"><a href="#cb34-4"></a>              <span class="at">grp2 =</span> op_carrier,</span>
<span id="cb34-5"><a href="#cb34-5"></a>              <span class="at">min_flights =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-6"><a href="#cb34-6"></a>   <span class="fu">mutate</span>(<span class="at">route_carrier =</span> <span class="fu">paste</span>(route_iata, op_carrier, <span class="at">sep =</span> <span class="st">"_via_"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb34-7"><a href="#cb34-7"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_profit)) <span class="sc">|&gt;</span> </span>
<span id="cb34-8"><a href="#cb34-8"></a>  <span class="fu">mutate</span>(<span class="at">rank_profit =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb34-9"><a href="#cb34-9"></a>  <span class="fu">slice_max</span>(avg_profit, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb34-10"><a href="#cb34-10"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> (<span class="fu">where</span>(is.numeric) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">contains</span>(<span class="st">"occ"</span>)),</span>
<span id="cb34-11"><a href="#cb34-11"></a>                  <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">round</span>(.x))) <span class="ot">-&gt;</span> top10routes_carriers_profit_summary</span>
<span id="cb34-12"><a href="#cb34-12"></a></span>
<span id="cb34-13"><a href="#cb34-13"></a><span class="co"># Identify routes in overall top 10 profit and route/carrier version</span></span>
<span id="cb34-14"><a href="#cb34-14"></a>top10routes_carriers_profit_summary <span class="sc">|&gt;</span> <span class="fu">pull</span>(route_iata) <span class="ot">-&gt;</span> top10routes_carriers_profit</span>
<span id="cb34-15"><a href="#cb34-15"></a>top10routes_profit_summary <span class="sc">|&gt;</span> <span class="fu">pull</span>(route_iata) <span class="ot">-&gt;</span> top10routes_profit</span>
<span id="cb34-16"><a href="#cb34-16"></a></span>
<span id="cb34-17"><a href="#cb34-17"></a><span class="co"># Visualize</span></span>
<span id="cb34-18"><a href="#cb34-18"></a>top10routes_carriers_profit_summary <span class="sc">|&gt;</span> </span>
<span id="cb34-19"><a href="#cb34-19"></a>  <span class="fu">doublebox_viz</span>(<span class="at">x =</span> route_carrier,</span>
<span id="cb34-20"><a href="#cb34-20"></a>                <span class="at">y =</span> avg_profit) <span class="sc">+</span></span>
<span id="cb34-21"><a href="#cb34-21"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Route &amp; Carrier"</span>,</span>
<span id="cb34-22"><a href="#cb34-22"></a>       <span class="at">y =</span> <span class="st">"Avg. Profit"</span>) <span class="sc">+</span></span>
<span id="cb34-23"><a href="#cb34-23"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">600000</span>, <span class="at">by =</span> <span class="dv">50000</span>),</span>
<span id="cb34-24"><a href="#cb34-24"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">600000</span>),</span>
<span id="cb34-25"><a href="#cb34-25"></a>                     <span class="at">labels =</span> \(x) <span class="fu">paste0</span>(<span class="st">"$"</span>, x)) <span class="sc">+</span></span>
<span id="cb34-26"><a href="#cb34-26"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-top10profit_routescarriers" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Flights-Analysis_files/figure-html/fig-top10profit_routescarriers-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;12: Top 10 routes &amp; carriers ordered by average profit</figcaption></figure>
</div>
</div>
</div>
<p>As seen above in <a href="#fig-top10profit_route_carrier_probe">Figure&nbsp;11</a>, there are a number of <code>routes</code> operated by specific <code>carriers</code> that did not appear in the overall T10 profit route list due to some <code>carriers</code> performing poorly on those <code>routes</code></p>
<ul>
<li>
<code>CLT-RDU</code>, <code>DFW-HSV</code>, <code>DTW-ROC</code>, <code>MSP-OMA</code>
</li>
</ul>
<p>This can be seen in further detail by looking at the inter-carrier variation for these additional routes in <a href="#fig-top10profit_discreps">Figure&nbsp;13</a>, where we see major differences in profit across carriers.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Takeaway: Certain routes may in fact have the potential to be highly profitable but do not appear so at first due to lower-performing carriers
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># IATA route codes for the new top routes</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="fu">setdiff</span>(top10routes_carriers_profit, top10routes_profit) <span class="ot">-&gt;</span> discreps</span>
<span id="cb35-3"><a href="#cb35-3"></a></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="co"># Viz - Filter for newer top routes and show carrier variability</span></span>
<span id="cb35-5"><a href="#cb35-5"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb35-6"><a href="#cb35-6"></a>  <span class="fu">filter</span>(route_iata <span class="sc">%in%</span> discreps) <span class="sc">|&gt;</span> </span>
<span id="cb35-7"><a href="#cb35-7"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> route_iata,</span>
<span id="cb35-8"><a href="#cb35-8"></a>             <span class="at">fill =</span> op_carrier,</span>
<span id="cb35-9"><a href="#cb35-9"></a>             <span class="at">y =</span> est_profit_total)) <span class="sc">+</span></span>
<span id="cb35-10"><a href="#cb35-10"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb35-11"><a href="#cb35-11"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb35-12"><a href="#cb35-12"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb35-13"><a href="#cb35-13"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb35-14"><a href="#cb35-14"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb35-15"><a href="#cb35-15"></a>        <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"firebrick"</span>),</span>
<span id="cb35-16"><a href="#cb35-16"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)) <span class="sc">+</span></span>
<span id="cb35-17"><a href="#cb35-17"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Profit ($) per Round Trip Flight"</span>,</span>
<span id="cb35-18"><a href="#cb35-18"></a>       <span class="at">fill =</span> <span class="st">"Carrier"</span>,</span>
<span id="cb35-19"><a href="#cb35-19"></a>       <span class="at">x =</span> <span class="st">"Route"</span>,</span>
<span id="cb35-20"><a href="#cb35-20"></a>       <span class="at">title =</span> <span class="st">"Variation in Profitability by Carrier"</span>,</span>
<span id="cb35-21"><a href="#cb35-21"></a>       <span class="at">subtitle =</span> <span class="st">"Routes that are highly profitable for some carriers but not others"</span>,</span>
<span id="cb35-22"><a href="#cb35-22"></a>       <span class="at">caption =</span> <span class="st">"Only routes w/20+ flights recorded included in profitability"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-top10profit_discreps" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Flights-Analysis_files/figure-html/fig-top10profit_discreps-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;13: Top routes with major profit discrepancies across carriers</figcaption></figure>
</div>
</div>
</div>
<section id="charlotte-raleigh" class="level4"><h4 class="anchored" data-anchor-id="charlotte-raleigh">Charlotte-Raleigh</h4>
<p>Of particular note is the <code>Charlotte-Raleigh</code> <code>(CLT-RDU)</code> route, where the regional carrier <code>OH</code> (a subsidiary of <code>American Airlines AA</code>) generates a massively greater average profit than <code>AA</code>. As with the <code>Vail-NY</code> route, this difference is driven by higher <code>fare_prices</code>.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="fu">filter</span>(route_iata <span class="sc">==</span> <span class="st">"CLT-RDU"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">summarize</span>(<span class="at">avg_profit =</span> <span class="fu">roundmean</span>(est_profit_total),</span>
<span id="cb36-4"><a href="#cb36-4"></a>            <span class="at">avg_revenue =</span> <span class="fu">roundmean</span>(est_all_revenue_total),</span>
<span id="cb36-5"><a href="#cb36-5"></a>            <span class="at">avg_occupany =</span> <span class="fu">roundmean</span>(avg_occ_rate_bothlegs),</span>
<span id="cb36-6"><a href="#cb36-6"></a>            <span class="at">avg_fare =</span> <span class="fu">roundmean</span>(med_fare_imputed),</span>
<span id="cb36-7"><a href="#cb36-7"></a>            <span class="at">.by =</span> op_carrier) <span class="sc">|&gt;</span> </span>
<span id="cb36-8"><a href="#cb36-8"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb36-9"><a href="#cb36-9"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Revenue and Fare Differences for CLT-RDU Route**"</span>),</span>
<span id="cb36-10"><a href="#cb36-10"></a>             <span class="at">subtitle =</span> <span class="fu">md</span>(<span class="st">"*Regional subsidiary generates higher revenue due to 3.5x higher ticket prices*"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="tbl-charlotte_rdu_comparisons" class="anchored">

<div id="ejfeulqmzd" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ejfeulqmzd table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ejfeulqmzd thead, #ejfeulqmzd tbody, #ejfeulqmzd tfoot, #ejfeulqmzd tr, #ejfeulqmzd td, #ejfeulqmzd th {
  border-style: none;
}

#ejfeulqmzd p {
  margin: 0;
  padding: 0;
}

#ejfeulqmzd .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ejfeulqmzd .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ejfeulqmzd .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ejfeulqmzd .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ejfeulqmzd .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ejfeulqmzd .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ejfeulqmzd .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ejfeulqmzd .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ejfeulqmzd .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ejfeulqmzd .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ejfeulqmzd .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ejfeulqmzd .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ejfeulqmzd .gt_spanner_row {
  border-bottom-style: hidden;
}

#ejfeulqmzd .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ejfeulqmzd .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ejfeulqmzd .gt_from_md > :first-child {
  margin-top: 0;
}

#ejfeulqmzd .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ejfeulqmzd .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ejfeulqmzd .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ejfeulqmzd .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ejfeulqmzd .gt_row_group_first td {
  border-top-width: 2px;
}

#ejfeulqmzd .gt_row_group_first th {
  border-top-width: 2px;
}

#ejfeulqmzd .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ejfeulqmzd .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ejfeulqmzd .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ejfeulqmzd .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ejfeulqmzd .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ejfeulqmzd .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ejfeulqmzd .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ejfeulqmzd .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ejfeulqmzd .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ejfeulqmzd .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ejfeulqmzd .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ejfeulqmzd .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ejfeulqmzd .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ejfeulqmzd .gt_left {
  text-align: left;
}

#ejfeulqmzd .gt_center {
  text-align: center;
}

#ejfeulqmzd .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ejfeulqmzd .gt_font_normal {
  font-weight: normal;
}

#ejfeulqmzd .gt_font_bold {
  font-weight: bold;
}

#ejfeulqmzd .gt_font_italic {
  font-style: italic;
}

#ejfeulqmzd .gt_super {
  font-size: 65%;
}

#ejfeulqmzd .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ejfeulqmzd .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ejfeulqmzd .gt_indent_1 {
  text-indent: 5px;
}

#ejfeulqmzd .gt_indent_2 {
  text-indent: 10px;
}

#ejfeulqmzd .gt_indent_3 {
  text-indent: 15px;
}

#ejfeulqmzd .gt_indent_4 {
  text-indent: 20px;
}

#ejfeulqmzd .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<caption>Table&nbsp;2:  <p>Charlotte-Raleigh differences in fares by carrier</p> </caption>
  <thead>
<tr class="gt_heading">
<td colspan="5" class="gt_heading gt_title gt_font_normal" style=""><strong>Revenue and Fare Differences for CLT-RDU Route</strong></td>
    </tr>
<tr class="gt_heading">
<td colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style=""><em>Regional subsidiary generates higher revenue due to 3.5x higher ticket prices</em></td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="op_carrier">op_carrier</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_profit">avg_profit</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_revenue">avg_revenue</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_occupany">avg_occupany</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_fare">avg_fare</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr>
<td headers="op_carrier" class="gt_row gt_left">AA</td>
<td headers="avg_profit" class="gt_row gt_right">85837.54</td>
<td headers="avg_revenue" class="gt_row gt_right">109192.8</td>
<td headers="avg_occupany" class="gt_row gt_right">0.65</td>
<td headers="avg_fare" class="gt_row gt_right">382</td>
</tr>
<tr>
<td headers="op_carrier" class="gt_row gt_left">OH</td>
<td headers="avg_profit" class="gt_row gt_right">308462.58</td>
<td headers="avg_revenue" class="gt_row gt_right">331149.4</td>
<td headers="avg_occupany" class="gt_row gt_right">0.69</td>
<td headers="avg_fare" class="gt_row gt_right">1159</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section><section id="profit-revenue-cost-interaction" class="level4"><h4 class="anchored" data-anchor-id="profit-revenue-cost-interaction">Profit, Revenue, Cost Interaction</h4>
<p>Lastly, the distribution and trade-off relationships between profit and its constituent components is directly visualized below, along with callouts for the top 10 most-profitable.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co">#| label: fig-top10profit_tradeoff</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="co">#| fig-cap: Profit as a function of cost and revenue with top 10 highlighted</span></span>
<span id="cb37-3"><a href="#cb37-3"></a></span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="co"># Base plot of cost, revenue, profit</span></span>
<span id="cb37-5"><a href="#cb37-5"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb37-6"><a href="#cb37-6"></a>  <span class="fu">flightdicer</span>(<span class="at">grp1 =</span> route_iata,</span>
<span id="cb37-7"><a href="#cb37-7"></a>              <span class="at">grp2 =</span> op_carrier,</span>
<span id="cb37-8"><a href="#cb37-8"></a>              <span class="at">min_flights =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-9"><a href="#cb37-9"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_profit)) <span class="sc">|&gt;</span> </span>
<span id="cb37-10"><a href="#cb37-10"></a>  <span class="fu">mutate</span>(<span class="at">rank_profit =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb37-11"><a href="#cb37-11"></a>  <span class="co">#slice_max(avg_profit, n = 10) |&gt; </span></span>
<span id="cb37-12"><a href="#cb37-12"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> (<span class="fu">where</span>(is.numeric) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">contains</span>(<span class="st">"occ"</span>)),</span>
<span id="cb37-13"><a href="#cb37-13"></a>                <span class="at">.fns =</span> <span class="sc">~</span><span class="fu">round</span>(.x))) <span class="sc">|&gt;</span> </span>
<span id="cb37-14"><a href="#cb37-14"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> avg_cost_total,</span>
<span id="cb37-15"><a href="#cb37-15"></a>             <span class="at">y =</span> avg_revenue_total,</span>
<span id="cb37-16"><a href="#cb37-16"></a>             <span class="at">color =</span> avg_profit)) <span class="sc">+</span></span>
<span id="cb37-17"><a href="#cb37-17"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb37-18"><a href="#cb37-18"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb37-19"><a href="#cb37-19"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"inferno"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-20"><a href="#cb37-20"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">600000</span>),</span>
<span id="cb37-21"><a href="#cb37-21"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">600000</span>, <span class="dv">100000</span>),</span>
<span id="cb37-22"><a href="#cb37-22"></a>                     <span class="at">labels =</span> \(x) <span class="fu">paste0</span>(<span class="st">"$"</span>,x)) <span class="sc">+</span></span>
<span id="cb37-23"><a href="#cb37-23"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100000</span>),</span>
<span id="cb37-24"><a href="#cb37-24"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">100000</span>, <span class="dv">10000</span>),</span>
<span id="cb37-25"><a href="#cb37-25"></a>                     <span class="at">labels =</span> \(x) <span class="fu">paste0</span>(<span class="st">"$"</span>,x)) <span class="sc">+</span></span>
<span id="cb37-26"><a href="#cb37-26"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Avg Total Cost"</span>,</span>
<span id="cb37-27"><a href="#cb37-27"></a>       <span class="at">y =</span> <span class="st">"Avg Total Revenue"</span>,</span>
<span id="cb37-28"><a href="#cb37-28"></a>       <span class="at">color =</span> <span class="st">"Avg Profit"</span>,</span>
<span id="cb37-29"><a href="#cb37-29"></a>       <span class="at">title =</span> <span class="st">"Total Revenue, Cost, and Profit for all Routes/Carriers"</span>,</span>
<span id="cb37-30"><a href="#cb37-30"></a>       <span class="at">subtitle =</span> <span class="st">"Top 10 Profitable Routes/Carriers are Highlighted"</span>) <span class="ot">-&gt;</span> p1</span>
<span id="cb37-31"><a href="#cb37-31"></a></span>
<span id="cb37-32"><a href="#cb37-32"></a><span class="co"># Identify Top 10 profitable route/carrier combos to create labels</span></span>
<span id="cb37-33"><a href="#cb37-33"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb37-34"><a href="#cb37-34"></a>  <span class="fu">flightdicer</span>(<span class="at">grp1 =</span> route_iata, </span>
<span id="cb37-35"><a href="#cb37-35"></a>              <span class="at">grp2 =</span> op_carrier,</span>
<span id="cb37-36"><a href="#cb37-36"></a>              <span class="at">min_flights =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-37"><a href="#cb37-37"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_profit)) <span class="sc">|&gt;</span></span>
<span id="cb37-38"><a href="#cb37-38"></a>  <span class="fu">mutate</span>(<span class="at">route_carrier =</span> <span class="fu">paste</span>(route_iata, op_carrier, <span class="at">sep =</span> <span class="st">"_via_"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb37-39"><a href="#cb37-39"></a>  <span class="fu">slice_max</span>(avg_profit, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-40"><a href="#cb37-40"></a>  <span class="fu">select</span>(route_carrier, avg_cost_total, avg_revenue_total, avg_profit) <span class="ot">-&gt;</span> top10labels</span>
<span id="cb37-41"><a href="#cb37-41"></a></span>
<span id="cb37-42"><a href="#cb37-42"></a><span class="co"># Add labels to main plot to call out top 10</span></span>
<span id="cb37-43"><a href="#cb37-43"></a>p1 <span class="sc">+</span></span>
<span id="cb37-44"><a href="#cb37-44"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> top10labels,</span>
<span id="cb37-45"><a href="#cb37-45"></a>                   <span class="fu">aes</span>(<span class="at">x =</span> avg_cost_total, <span class="at">y =</span> avg_revenue_total, <span class="at">label =</span> route_carrier),</span>
<span id="cb37-46"><a href="#cb37-46"></a>                   <span class="at">box.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb37-47"><a href="#cb37-47"></a>                   <span class="at">point.padding =</span> <span class="dv">1</span>,</span>
<span id="cb37-48"><a href="#cb37-48"></a>                   <span class="at">force =</span> <span class="dv">1</span>,</span>
<span id="cb37-49"><a href="#cb37-49"></a>                   <span class="at">max.overlaps =</span> <span class="dv">100</span>,</span>
<span id="cb37-50"><a href="#cb37-50"></a>                   <span class="at">segment.color =</span> <span class="st">"black"</span>,</span>
<span id="cb37-51"><a href="#cb37-51"></a>                   <span class="at">segment.size =</span> <span class="fl">0.5</span>,</span>
<span id="cb37-52"><a href="#cb37-52"></a>                   <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb37-53"><a href="#cb37-53"></a>                   <span class="at">size =</span> <span class="dv">3</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<p><img src="Flights-Analysis_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally, the summary statistics for the top 10 most profitable <code>routes/carriers</code> are displayed below</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb38-2"><a href="#cb38-2"></a>  <span class="fu">flightdicer</span>(<span class="at">grp1 =</span> route_iata, </span>
<span id="cb38-3"><a href="#cb38-3"></a>              <span class="at">grp2 =</span> op_carrier,</span>
<span id="cb38-4"><a href="#cb38-4"></a>              <span class="at">min_flights =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-5"><a href="#cb38-5"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_profit)) <span class="sc">|&gt;</span></span>
<span id="cb38-6"><a href="#cb38-6"></a>  <span class="fu">mutate</span>(<span class="at">route_carrier =</span> <span class="fu">paste</span>(route_iata, op_carrier, <span class="at">sep =</span> <span class="st">"_via_"</span>),</span>
<span id="cb38-7"><a href="#cb38-7"></a>         <span class="at">rank_profit =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb38-8"><a href="#cb38-8"></a>  <span class="fu">slice_max</span>(avg_profit, <span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-9"><a href="#cb38-9"></a>  <span class="fu">select</span>(rank_profit,route_iata, op_carrier, avg_profit, avg_revenue_total, avg_cost_total) <span class="sc">|&gt;</span> </span>
<span id="cb38-10"><a href="#cb38-10"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb38-11"><a href="#cb38-11"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Summary Statistics for Top 10 Profitable Routes &amp; Carriers**"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="tbl-top10routecarrier_final" class="anchored">

<div id="rwbexrnmgo" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rwbexrnmgo table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rwbexrnmgo thead, #rwbexrnmgo tbody, #rwbexrnmgo tfoot, #rwbexrnmgo tr, #rwbexrnmgo td, #rwbexrnmgo th {
  border-style: none;
}

#rwbexrnmgo p {
  margin: 0;
  padding: 0;
}

#rwbexrnmgo .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rwbexrnmgo .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rwbexrnmgo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rwbexrnmgo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rwbexrnmgo .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rwbexrnmgo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rwbexrnmgo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rwbexrnmgo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rwbexrnmgo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rwbexrnmgo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rwbexrnmgo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rwbexrnmgo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rwbexrnmgo .gt_spanner_row {
  border-bottom-style: hidden;
}

#rwbexrnmgo .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rwbexrnmgo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rwbexrnmgo .gt_from_md > :first-child {
  margin-top: 0;
}

#rwbexrnmgo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rwbexrnmgo .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rwbexrnmgo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rwbexrnmgo .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rwbexrnmgo .gt_row_group_first td {
  border-top-width: 2px;
}

#rwbexrnmgo .gt_row_group_first th {
  border-top-width: 2px;
}

#rwbexrnmgo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rwbexrnmgo .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rwbexrnmgo .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rwbexrnmgo .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rwbexrnmgo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rwbexrnmgo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rwbexrnmgo .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rwbexrnmgo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rwbexrnmgo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rwbexrnmgo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rwbexrnmgo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rwbexrnmgo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rwbexrnmgo .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rwbexrnmgo .gt_left {
  text-align: left;
}

#rwbexrnmgo .gt_center {
  text-align: center;
}

#rwbexrnmgo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rwbexrnmgo .gt_font_normal {
  font-weight: normal;
}

#rwbexrnmgo .gt_font_bold {
  font-weight: bold;
}

#rwbexrnmgo .gt_font_italic {
  font-style: italic;
}

#rwbexrnmgo .gt_super {
  font-size: 65%;
}

#rwbexrnmgo .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rwbexrnmgo .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rwbexrnmgo .gt_indent_1 {
  text-indent: 5px;
}

#rwbexrnmgo .gt_indent_2 {
  text-indent: 10px;
}

#rwbexrnmgo .gt_indent_3 {
  text-indent: 15px;
}

#rwbexrnmgo .gt_indent_4 {
  text-indent: 20px;
}

#rwbexrnmgo .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<caption>Table&nbsp;3:  <p>Summary stats for top 10 profitable routes by specific carriers</p> </caption>
  <thead>
<tr class="gt_heading">
<td colspan="6" class="gt_heading gt_title gt_font_normal gt_bottom_border" style=""><strong>Summary Statistics for Top 10 Profitable Routes &amp; Carriers</strong></td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="rank_profit">rank_profit</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="route_iata">route_iata</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="op_carrier">op_carrier</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_profit">avg_profit</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_revenue_total">avg_revenue_total</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_cost_total">avg_cost_total</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr>
<td headers="rank_profit" class="gt_row gt_right">1</td>
<td headers="route_iata" class="gt_row gt_left">EGE-JFK</td>
<td headers="op_carrier" class="gt_row gt_left">AA</td>
<td headers="avg_profit" class="gt_row gt_right">512847.7</td>
<td headers="avg_revenue_total" class="gt_row gt_right">564443.2</td>
<td headers="avg_cost_total" class="gt_row gt_right">51595.45</td>
</tr>
<tr>
<td headers="rank_profit" class="gt_row gt_right">2</td>
<td headers="route_iata" class="gt_row gt_left">CLT-RDU</td>
<td headers="op_carrier" class="gt_row gt_left">OH</td>
<td headers="avg_profit" class="gt_row gt_right">308462.6</td>
<td headers="avg_revenue_total" class="gt_row gt_right">331149.4</td>
<td headers="avg_cost_total" class="gt_row gt_right">22686.80</td>
</tr>
<tr>
<td headers="rank_profit" class="gt_row gt_right">3</td>
<td headers="route_iata" class="gt_row gt_left">CLT-ILM</td>
<td headers="op_carrier" class="gt_row gt_left">AA</td>
<td headers="avg_profit" class="gt_row gt_right">227219.8</td>
<td headers="avg_revenue_total" class="gt_row gt_right">246270.7</td>
<td headers="avg_cost_total" class="gt_row gt_right">19050.87</td>
</tr>
<tr>
<td headers="rank_profit" class="gt_row gt_right">4</td>
<td headers="route_iata" class="gt_row gt_left">CVG-DTW</td>
<td headers="op_carrier" class="gt_row gt_left">OO</td>
<td headers="avg_profit" class="gt_row gt_right">226431.3</td>
<td headers="avg_revenue_total" class="gt_row gt_right">255727.7</td>
<td headers="avg_cost_total" class="gt_row gt_right">29296.35</td>
</tr>
<tr>
<td headers="rank_profit" class="gt_row gt_right">5</td>
<td headers="route_iata" class="gt_row gt_left">DFW-HSV</td>
<td headers="op_carrier" class="gt_row gt_left">MQ</td>
<td headers="avg_profit" class="gt_row gt_right">212906.1</td>
<td headers="avg_revenue_total" class="gt_row gt_right">244750.0</td>
<td headers="avg_cost_total" class="gt_row gt_right">31843.91</td>
</tr>
<tr>
<td headers="rank_profit" class="gt_row gt_right">6</td>
<td headers="route_iata" class="gt_row gt_left">DTW-ROC</td>
<td headers="op_carrier" class="gt_row gt_left">G7</td>
<td headers="avg_profit" class="gt_row gt_right">211990.7</td>
<td headers="avg_revenue_total" class="gt_row gt_right">243482.8</td>
<td headers="avg_cost_total" class="gt_row gt_right">31492.12</td>
</tr>
<tr>
<td headers="rank_profit" class="gt_row gt_right">7</td>
<td headers="route_iata" class="gt_row gt_left">JAC-MSP</td>
<td headers="op_carrier" class="gt_row gt_left">DL</td>
<td headers="avg_profit" class="gt_row gt_right">207088.6</td>
<td headers="avg_revenue_total" class="gt_row gt_right">240298.5</td>
<td headers="avg_cost_total" class="gt_row gt_right">33209.92</td>
</tr>
<tr>
<td headers="rank_profit" class="gt_row gt_right">8</td>
<td headers="route_iata" class="gt_row gt_left">CLT-MYR</td>
<td headers="op_carrier" class="gt_row gt_left">OH</td>
<td headers="avg_profit" class="gt_row gt_right">205724.0</td>
<td headers="avg_revenue_total" class="gt_row gt_right">224609.8</td>
<td headers="avg_cost_total" class="gt_row gt_right">18885.79</td>
</tr>
<tr>
<td headers="rank_profit" class="gt_row gt_right">9</td>
<td headers="route_iata" class="gt_row gt_left">CLT-MYR</td>
<td headers="op_carrier" class="gt_row gt_left">AA</td>
<td headers="avg_profit" class="gt_row gt_right">203170.4</td>
<td headers="avg_revenue_total" class="gt_row gt_right">225288.7</td>
<td headers="avg_cost_total" class="gt_row gt_right">22118.29</td>
</tr>
<tr>
<td headers="rank_profit" class="gt_row gt_right">10</td>
<td headers="route_iata" class="gt_row gt_left">MSP-OMA</td>
<td headers="op_carrier" class="gt_row gt_left">9E</td>
<td headers="avg_profit" class="gt_row gt_right">199564.4</td>
<td headers="avg_revenue_total" class="gt_row gt_right">228832.3</td>
<td headers="avg_cost_total" class="gt_row gt_right">29267.90</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</section></section></section><section id="drivers-kpis" class="level2"><h2 class="anchored" data-anchor-id="drivers-kpis">Drivers &amp; KPIs</h2>
<p>Based on the above profitability analyses, we have some general ideas about what drives success:</p>
<ul>
<li><p>Smaller regional airlines and/or low-volume routes can be highly successful by leveraging <code>ticket_fare</code> prices</p></li>
<li><p>Routes alone arent a guarantee of success due to variability across carriers</p></li>
</ul>
<section id="profitability-heatmap" class="level3"><h3 class="anchored" data-anchor-id="profitability-heatmap">Profitability Heatmap</h3>
<p>For the final analysis, correlation heatmaps were used upon the full set of <code>routes/carriers</code> to uncover the greatest drivers of profitability. <a href="#fig-heatmaps_drivers_routecarriers">Figure&nbsp;14</a> shows that:</p>
<ul>
<li><p>The biggest positive driver of <code>average_profit</code> is the <code>average_ticket_fare</code> charged, followed to a much lesser extent by <code>passenger</code> and <code>baggage</code> counts.</p></li>
<li>
<p>The <code>average_ticket_fare</code> has a moderate positive correlation with <code>distance</code> and a mild negative correlation with <code>delay_time</code>,</p>
<ul>
<li>Longer flights tend to command higher fares, while longer delay times command reduced fares</li>
</ul>
</li>
<li>
<p>The <code>average_profit</code> of a route is also negatively impacted slightly by <code>airport_costs</code> and <code>distance</code></p>
<ul>
<li>Even though greater distances yield higher fares, it appears insufficient to offset the profit decrease resulting from increased turn-around time, lower volume and increased delay potential</li>
</ul>
</li>
</ul>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># Summary Stats for key profit components by route/carrier w 10+ flights</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb39-3"><a href="#cb39-3"></a>  <span class="fu">flightdicer</span>(<span class="at">grp1 =</span> route_iata, </span>
<span id="cb39-4"><a href="#cb39-4"></a>              <span class="at">grp2 =</span> op_carrier,</span>
<span id="cb39-5"><a href="#cb39-5"></a>              <span class="at">min_flights =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb39-6"><a href="#cb39-6"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_profit)) <span class="sc">|&gt;</span> </span>
<span id="cb39-7"><a href="#cb39-7"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Flights (#)</span><span class="st">`</span> <span class="ot">=</span> n_flights,</span>
<span id="cb39-8"><a href="#cb39-8"></a>         <span class="st">`</span><span class="at">Planes (#)</span><span class="st">`</span> <span class="ot">=</span> n_planes,</span>
<span id="cb39-9"><a href="#cb39-9"></a>         <span class="st">`</span><span class="at">Days Flown (#)</span><span class="st">`</span> <span class="ot">=</span> n_flightdays,</span>
<span id="cb39-10"><a href="#cb39-10"></a>         <span class="st">`</span><span class="at">Avg. Profit ($)</span><span class="st">`</span> <span class="ot">=</span> avg_profit,</span>
<span id="cb39-11"><a href="#cb39-11"></a>         <span class="st">`</span><span class="at">Fare Price ($)</span><span class="st">`</span> <span class="ot">=</span> avg_median_fare, </span>
<span id="cb39-12"><a href="#cb39-12"></a>         <span class="st">`</span><span class="at">Bags (#)</span><span class="st">`</span> <span class="ot">=</span> avg_n_bags,</span>
<span id="cb39-13"><a href="#cb39-13"></a>         <span class="st">`</span><span class="at">Passengers (#)</span><span class="st">`</span> <span class="ot">=</span> avg_n_passengers,</span>
<span id="cb39-14"><a href="#cb39-14"></a>         <span class="st">`</span><span class="at">Distance</span><span class="st">`</span> <span class="ot">=</span> avg_distance,</span>
<span id="cb39-15"><a href="#cb39-15"></a>         <span class="st">`</span><span class="at">Airport Costs</span><span class="st">`</span> <span class="ot">=</span> avg_airport_costs, </span>
<span id="cb39-16"><a href="#cb39-16"></a>         <span class="st">`</span><span class="at">Delay Time</span><span class="st">`</span> <span class="ot">=</span> avg_delay_time) <span class="ot">-&gt;</span> key_driver_summary</span>
<span id="cb39-17"><a href="#cb39-17"></a></span>
<span id="cb39-18"><a href="#cb39-18"></a><span class="co"># Correlation Matrix</span></span>
<span id="cb39-19"><a href="#cb39-19"></a><span class="fu">cor</span>(key_driver_summary) <span class="ot">-&gt;</span> profit_cormat_routes_carriers</span>
<span id="cb39-20"><a href="#cb39-20"></a><span class="co"># P-values for test of signifance re: correlations</span></span>
<span id="cb39-21"><a href="#cb39-21"></a><span class="fu">cor_pmat</span>(key_driver_summary) <span class="ot">-&gt;</span> profit_cormat_routes_carriers_pvals</span>
<span id="cb39-22"><a href="#cb39-22"></a></span>
<span id="cb39-23"><a href="#cb39-23"></a><span class="co"># Prettier with LABELS</span></span>
<span id="cb39-24"><a href="#cb39-24"></a><span class="fu">ggcorrplot</span>(profit_cormat_routes_carriers, <span class="at">method =</span> <span class="st">"square"</span>,</span>
<span id="cb39-25"><a href="#cb39-25"></a>           <span class="at">hc.order =</span> T, <span class="at">outline.color =</span> <span class="st">"grey30"</span>,<span class="at">lab_size =</span> <span class="dv">3</span>,</span>
<span id="cb39-26"><a href="#cb39-26"></a>           <span class="at">lab =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-heatmaps_drivers_routecarriers" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="Flights-Analysis_files/figure-html/fig-heatmaps_drivers_routecarriers-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;14: Correlation heatmap displaying key profitability components</figcaption></figure>
</div>
</div>
</div>
</section><section id="driver-takeaways" class="level3"><h3 class="anchored" data-anchor-id="driver-takeaways">Driver Takeaways</h3>
<p>Based on the heatmap results, the following is concluded about profitability drivers:</p>
<ol type="1">
<li>
<code>ticket_fares</code> are by far the best lever for raising <code>profitability</code>
</li>
<li>Shorter <code>distance</code> flights can help boost profit by decreasing turn-around time and delays, while optimizing the number of possible flights</li>
<li>Maximizing <code>occupancy_rates</code> boosts profit by raising total revenue from <code>ticket_fare</code> and <code>baggage_fees</code>, and is especially critical for carriers with only a small number of planes.</li>
</ol></section></section></section><section id="final-recommendation" class="level1"><h1>Final Recommendation</h1>
<p>Based on the findings detailed above, the limitations imposed by only having 5 planes, and the brand commitment to punctuality, the following approach is suggested:</p>
<ol type="1">
<li>Identify the top 25 most-profitable specific <code>route/carrier</code> combinations</li>
<li>Use quantile ranks to filter these 25 flights for those with higher <code>ticket_fares</code>, shorter <code>distances</code>, lower <code>delay_times</code>, and greater <code>occupancy_rates</code>
<ol type="1">
<li>Focusing on reduced delay_times and distance also supports the key brand component of punctuality</li>
</ol>
</li>
<li>Emulate the approach of highly-profitable low-volume regional airlines</li>
</ol>
<section id="top-5-recommended-routes" class="level2"><h2 class="anchored" data-anchor-id="top-5-recommended-routes">Top 5 Recommended Routes</h2>
<p>In following this approach, we land upon the final 5 routes:</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># Summary Stats for flights ordered by average profit</span></span>
<span id="cb40-2"><a href="#cb40-2"></a>flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3"></a>  <span class="fu">flightdicer</span>(<span class="at">grp1 =</span> route_iata, </span>
<span id="cb40-4"><a href="#cb40-4"></a>              <span class="at">grp2 =</span> op_carrier,</span>
<span id="cb40-5"><a href="#cb40-5"></a>              <span class="at">min_flights =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-6"><a href="#cb40-6"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_profit)) <span class="sc">|&gt;</span></span>
<span id="cb40-7"><a href="#cb40-7"></a>  <span class="co"># Filter for top 25 profit levels</span></span>
<span id="cb40-8"><a href="#cb40-8"></a>  <span class="fu">slice_max</span>(avg_profit, <span class="at">n =</span> <span class="dv">25</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-9"><a href="#cb40-9"></a>  <span class="co"># Filter for top quantile fare and occupancy rate, low tile distance and delay</span></span>
<span id="cb40-10"><a href="#cb40-10"></a>  <span class="fu">filter</span>(avg_median_fare_decile <span class="sc">==</span> <span class="dv">20</span>,</span>
<span id="cb40-11"><a href="#cb40-11"></a>         avg_occupancy_rate_decile <span class="sc">&gt;=</span> <span class="dv">15</span>,</span>
<span id="cb40-12"><a href="#cb40-12"></a>         avg_distance_decile <span class="sc">&lt;=</span> <span class="dv">5</span>,</span>
<span id="cb40-13"><a href="#cb40-13"></a>         avg_delay_time_decile <span class="sc">&lt;=</span> <span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-14"><a href="#cb40-14"></a>  <span class="fu">select</span>(route_iata, op_carrier, avg_profit) <span class="ot">-&gt;</span> finaltop5</span>
<span id="cb40-15"><a href="#cb40-15"></a></span>
<span id="cb40-16"><a href="#cb40-16"></a><span class="co"># Pull in full route name for clarity</span></span>
<span id="cb40-17"><a href="#cb40-17"></a>finaltop5 <span class="sc">|&gt;</span> </span>
<span id="cb40-18"><a href="#cb40-18"></a>  <span class="fu">left_join</span>(flights_medlarge_roundtrip <span class="sc">|&gt;</span> </span>
<span id="cb40-19"><a href="#cb40-19"></a>              <span class="fu">distinct</span>(route_iata, route_city_name),</span>
<span id="cb40-20"><a href="#cb40-20"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"route_iata"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb40-21"><a href="#cb40-21"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-22"><a href="#cb40-22"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Final Top 5 Routes**"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="tbl-top5routes" class="anchored">

<div id="tmmxfmyebx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#tmmxfmyebx table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#tmmxfmyebx thead, #tmmxfmyebx tbody, #tmmxfmyebx tfoot, #tmmxfmyebx tr, #tmmxfmyebx td, #tmmxfmyebx th {
  border-style: none;
}

#tmmxfmyebx p {
  margin: 0;
  padding: 0;
}

#tmmxfmyebx .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tmmxfmyebx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#tmmxfmyebx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tmmxfmyebx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tmmxfmyebx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tmmxfmyebx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tmmxfmyebx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tmmxfmyebx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tmmxfmyebx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tmmxfmyebx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tmmxfmyebx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tmmxfmyebx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tmmxfmyebx .gt_spanner_row {
  border-bottom-style: hidden;
}

#tmmxfmyebx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#tmmxfmyebx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tmmxfmyebx .gt_from_md > :first-child {
  margin-top: 0;
}

#tmmxfmyebx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tmmxfmyebx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tmmxfmyebx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#tmmxfmyebx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#tmmxfmyebx .gt_row_group_first td {
  border-top-width: 2px;
}

#tmmxfmyebx .gt_row_group_first th {
  border-top-width: 2px;
}

#tmmxfmyebx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tmmxfmyebx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#tmmxfmyebx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#tmmxfmyebx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tmmxfmyebx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tmmxfmyebx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tmmxfmyebx .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#tmmxfmyebx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tmmxfmyebx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tmmxfmyebx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tmmxfmyebx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tmmxfmyebx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tmmxfmyebx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tmmxfmyebx .gt_left {
  text-align: left;
}

#tmmxfmyebx .gt_center {
  text-align: center;
}

#tmmxfmyebx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tmmxfmyebx .gt_font_normal {
  font-weight: normal;
}

#tmmxfmyebx .gt_font_bold {
  font-weight: bold;
}

#tmmxfmyebx .gt_font_italic {
  font-style: italic;
}

#tmmxfmyebx .gt_super {
  font-size: 65%;
}

#tmmxfmyebx .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#tmmxfmyebx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#tmmxfmyebx .gt_indent_1 {
  text-indent: 5px;
}

#tmmxfmyebx .gt_indent_2 {
  text-indent: 10px;
}

#tmmxfmyebx .gt_indent_3 {
  text-indent: 15px;
}

#tmmxfmyebx .gt_indent_4 {
  text-indent: 20px;
}

#tmmxfmyebx .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<caption>Table&nbsp;4:  <p>Final top 5 routes based on profit, delay, distance, occupancy, and
fares</p> </caption>
  <thead>
<tr class="gt_heading">
<td colspan="4" class="gt_heading gt_title gt_font_normal gt_bottom_border" style=""><strong>Final Top 5 Routes</strong></td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="route_iata">route_iata</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="op_carrier">op_carrier</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_profit">avg_profit</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="route_city_name">route_city_name</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr>
<td headers="route_iata" class="gt_row gt_left">CLT-RDU</td>
<td headers="op_carrier" class="gt_row gt_left">OH</td>
<td headers="avg_profit" class="gt_row gt_right">308462.6</td>
<td headers="route_city_name" class="gt_row gt_left">Charlotte, NC-Raleigh/Durham, NC</td>
</tr>
<tr>
<td headers="route_iata" class="gt_row gt_left">CLT-ILM</td>
<td headers="op_carrier" class="gt_row gt_left">AA</td>
<td headers="avg_profit" class="gt_row gt_right">227219.8</td>
<td headers="route_city_name" class="gt_row gt_left">Charlotte, NC-Wilmington, NC</td>
</tr>
<tr>
<td headers="route_iata" class="gt_row gt_left">DTW-IND</td>
<td headers="op_carrier" class="gt_row gt_left">OO</td>
<td headers="avg_profit" class="gt_row gt_right">190335.6</td>
<td headers="route_city_name" class="gt_row gt_left">Detroit, MI-Indianapolis, IN</td>
</tr>
<tr>
<td headers="route_iata" class="gt_row gt_left">CLE-DTW</td>
<td headers="op_carrier" class="gt_row gt_left">9E</td>
<td headers="avg_profit" class="gt_row gt_right">180941.8</td>
<td headers="route_city_name" class="gt_row gt_left">Cleveland, OH-Detroit, MI</td>
</tr>
<tr>
<td headers="route_iata" class="gt_row gt_left">ATL-LEX</td>
<td headers="op_carrier" class="gt_row gt_left">DL</td>
<td headers="avg_profit" class="gt_row gt_right">170716.1</td>
<td headers="route_city_name" class="gt_row gt_left">Atlanta, GA-Lexington, KY</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Quantiles used for selecting routes range from 1 to 20 on each metric, where the 20th quantile corresponds to the top 5% raw values of each metric, and the 1st quintile equates to the bottom 5% raw values
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section><section id="roi-to-break-even" class="level2"><h2 class="anchored" data-anchor-id="roi-to-break-even">ROI to Break Even</h2>
<p>Using the average profitability estimates for our final top 5 flights, we can calculate the estimated number of flights required for each to recoup the initial $90m investment per plane. As shown below, <strong>each of the 5 routes will require between 300 - 500 flights to break even</strong>.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>finaltop5 <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">mutate</span>(<span class="at">n_flights_breakeven =</span> <span class="fu">round</span>(<span class="dv">90000000</span><span class="sc">/</span>avg_profit)) <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a href="#cb41-3"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb41-4"><a href="#cb41-4"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Number of Flights Required to Recoup Plane Investment**"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">

<div id="rozzjhhhwh" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rozzjhhhwh table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rozzjhhhwh thead, #rozzjhhhwh tbody, #rozzjhhhwh tfoot, #rozzjhhhwh tr, #rozzjhhhwh td, #rozzjhhhwh th {
  border-style: none;
}

#rozzjhhhwh p {
  margin: 0;
  padding: 0;
}

#rozzjhhhwh .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rozzjhhhwh .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rozzjhhhwh .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rozzjhhhwh .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rozzjhhhwh .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rozzjhhhwh .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rozzjhhhwh .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rozzjhhhwh .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rozzjhhhwh .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rozzjhhhwh .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rozzjhhhwh .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rozzjhhhwh .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rozzjhhhwh .gt_spanner_row {
  border-bottom-style: hidden;
}

#rozzjhhhwh .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rozzjhhhwh .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rozzjhhhwh .gt_from_md > :first-child {
  margin-top: 0;
}

#rozzjhhhwh .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rozzjhhhwh .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rozzjhhhwh .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rozzjhhhwh .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rozzjhhhwh .gt_row_group_first td {
  border-top-width: 2px;
}

#rozzjhhhwh .gt_row_group_first th {
  border-top-width: 2px;
}

#rozzjhhhwh .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rozzjhhhwh .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rozzjhhhwh .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rozzjhhhwh .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rozzjhhhwh .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rozzjhhhwh .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rozzjhhhwh .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rozzjhhhwh .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rozzjhhhwh .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rozzjhhhwh .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rozzjhhhwh .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rozzjhhhwh .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rozzjhhhwh .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rozzjhhhwh .gt_left {
  text-align: left;
}

#rozzjhhhwh .gt_center {
  text-align: center;
}

#rozzjhhhwh .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rozzjhhhwh .gt_font_normal {
  font-weight: normal;
}

#rozzjhhhwh .gt_font_bold {
  font-weight: bold;
}

#rozzjhhhwh .gt_font_italic {
  font-style: italic;
}

#rozzjhhhwh .gt_super {
  font-size: 65%;
}

#rozzjhhhwh .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rozzjhhhwh .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rozzjhhhwh .gt_indent_1 {
  text-indent: 5px;
}

#rozzjhhhwh .gt_indent_2 {
  text-indent: 10px;
}

#rozzjhhhwh .gt_indent_3 {
  text-indent: 15px;
}

#rozzjhhhwh .gt_indent_4 {
  text-indent: 20px;
}

#rozzjhhhwh .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading">
<td colspan="4" class="gt_heading gt_title gt_font_normal gt_bottom_border" style=""><strong>Number of Flights Required to Recoup Plane Investment</strong></td>
    </tr>
<tr class="gt_col_headings">
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="route_iata">route_iata</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="op_carrier">op_carrier</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="avg_profit">avg_profit</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="n_flights_breakeven">n_flights_breakeven</th>
    </tr>
</thead>
<tbody class="gt_table_body">
<tr>
<td headers="route_iata" class="gt_row gt_left">CLT-RDU</td>
<td headers="op_carrier" class="gt_row gt_left">OH</td>
<td headers="avg_profit" class="gt_row gt_right">308462.6</td>
<td headers="n_flights_breakeven" class="gt_row gt_right">292</td>
</tr>
<tr>
<td headers="route_iata" class="gt_row gt_left">CLT-ILM</td>
<td headers="op_carrier" class="gt_row gt_left">AA</td>
<td headers="avg_profit" class="gt_row gt_right">227219.8</td>
<td headers="n_flights_breakeven" class="gt_row gt_right">396</td>
</tr>
<tr>
<td headers="route_iata" class="gt_row gt_left">DTW-IND</td>
<td headers="op_carrier" class="gt_row gt_left">OO</td>
<td headers="avg_profit" class="gt_row gt_right">190335.6</td>
<td headers="n_flights_breakeven" class="gt_row gt_right">473</td>
</tr>
<tr>
<td headers="route_iata" class="gt_row gt_left">CLE-DTW</td>
<td headers="op_carrier" class="gt_row gt_left">9E</td>
<td headers="avg_profit" class="gt_row gt_right">180941.8</td>
<td headers="n_flights_breakeven" class="gt_row gt_right">497</td>
</tr>
<tr>
<td headers="route_iata" class="gt_row gt_left">ATL-LEX</td>
<td headers="op_carrier" class="gt_row gt_left">DL</td>
<td headers="avg_profit" class="gt_row gt_right">170716.1</td>
<td headers="n_flights_breakeven" class="gt_row gt_right">527</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section><section id="kpi-monitoring" class="level2"><h2 class="anchored" data-anchor-id="kpi-monitoring">KPI Monitoring</h2>
<p>The following KPIs should be monitored to track progress going forward:</p>
<ol type="1">
<li>All metrics involved in profitability calculations
<ol type="1">
<li>
<code>distance</code>, <code>number_flights</code>, <code>occupancy_rate</code>, <code>ticket_fares</code>, <code>operational_costs</code>, <code>baggage_fees</code>, <code>delay_time</code>
</li>
</ol>
</li>
<li>Proportion of on-time flights and resulting customer satisfaction (via survey data)</li>
<li>Number of round-trip flights that a single plane can take in a single flight day
<ol type="1">
<li>Monitor demand and <code>occupancy_rate</code> to gauge if customer appetite is there for 2+ flights a day on the shorter-distance routes</li>
</ol>
</li>
</ol>
<section id="additional-considerations-limitations" class="level3"><h3 class="anchored" data-anchor-id="additional-considerations-limitations">Additional Considerations &amp; Limitations</h3>
<p>The following considerations should also be taken into account:</p>
<ol type="1">
<li>All analyses are based only on 1Q2019 data, and the world has certainly changed since then</li>
<li>Seasonality is not taken into account, and that is arguably one of the biggest factors in airline profit
<ol type="1">
<li>Especially critical given <code>ticket_fares</code> are the biggest lever in profitability</li>
</ol>
</li>
<li>Profitability estimates dont take into account the infrastructure and efficiency advantage that some of the major carriers have, particularly at their hubs (e.g.&nbsp;Deltas <code>ATL</code> hub)
<ol type="1">
<li>Unrealistic to truly assume static universal operational costs</li>
<li>Hub-based model is critical to modern airline efficiency</li>
</ol>
</li>
</ol>
<hr></section></section></section><section id="appendix" class="level1"><h1>Appendix</h1>
<section id="cost-revenue-assumptions" class="level2"><h2 class="anchored" data-anchor-id="cost-revenue-assumptions">Cost &amp; Revenue Assumptions</h2>
<p>Calculations included the following assumptions:</p>
<section id="costs-1" class="level3"><h3 class="anchored" data-anchor-id="costs-1">Costs</h3>
<ul>
<li>
<p>Mileage-variable costs totaling $9.18/mile</p>
<ul>
<li><p>$8.00 for fuel, oil, maintenance, crew</p></li>
<li><p>$1.18 for depreciation, insurance, other</p></li>
<li><p>Plane make/model variations not considered</p></li>
</ul>
</li>
<li>
<p>Airport operational costs based on landing airport size assessed once per flight leg</p>
<ul>
<li><p>$5000 for medium-size</p></li>
<li><p>$10000 for large-size</p></li>
</ul>
</li>
<li>
<p>Delay costs can be assessed a total of 4 times as there are 2 flight legs that each have a departure and an arrival</p>
<ul>
<li><p>Each departure and arrival given initial 15 minute grace period</p></li>
<li><p>$75 charged for every minute of delays past the grace period</p></li>
<li><p>Delays calculated separately for each departure and arrival, such that early arrivals or departures do not detract from earlier delay costs</p></li>
</ul>
</li>
<li>
<p>Plane cost fixed at $90 million per plane</p>
<ul>
<li>Plane cost was <em>not</em> considered in profitability, but <em>was</em> considered when calculating expected break-even points</li>
</ul>
</li>
</ul></section><section id="revenue-1" class="level3"><h3 class="anchored" data-anchor-id="revenue-1">Revenue</h3>
<ul>
<li>
<p>Max passenger capacity of 200 passengers for all 5 planes</p>
<ul>
<li><p>Plane make/model variability not considered</p></li>
<li><p>Number of passengers per flight leg calculated based on occupancy rates</p></li>
</ul>
</li>
<li>
<p>Baggage fees of $35 per bag assessed based on an expectation of 1 bag checked for 50% of passengers per flight leg</p>
<ul>
<li>Baggage fees were first calculated <em>per flight leg</em> based on the expected number of passengers and then summed across both legs</li>
</ul>
</li>
<li>
<p>Ticket prices are assessed using an estimated median fixed fee per route</p>
<ul>
<li>fares estimated from incomplete representative sample</li>
<li>seasonality ignored</li>
<li>plane make/model variability ignored</li>
</ul>
</li>
</ul>
<hr></section></section></section></main><!-- /main column --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>